import{a as d,j as e,C as U,B as m,q as me,s as xe,t as q,v as h,w as pe,x as g,y as te,k as T,J as V,I as G,U as re,A as le,z as ye,e as ke,u as be,l as je,p as Ne,S as ve,D as oe,E as K}from"./index-CtyxRQH4.js";import{u as _e,o as we}from"./index.esm-2_PVM501.js";import{F as Y,a as Q,b as de,S as Ce,D as ne}from"./dynamicForms-DwDa1hz7.js";import{P as De}from"./Page-BJSFnXB0.js";import{d as se,a as Se,c as Fe,e as Oe,u as Ae,b as Pe}from"./useApiHook-CSVdL_yw.js";import{F as ue,C as Te}from"./CarProfiles-y-wpYV4D.js";import{z as Z,F as O}from"./transition-BL_LW8qL.js";import{y as ee,j as ae}from"./iconBase-S9e1lt1i.js";import{C as Ee}from"./ConfirmModal-DUZVYQ2_.js";import{F as ze,a as Re}from"./TrashIcon-C46bdLOR.js";import{F as Me}from"./DocumentPlusIcon-MlLjCVQF.js";import"./Datepicker-BwTrHlpU.js";import"./combobox-DsMcaqGd.js";import"./use-by-comparator-BWPv7Nm-.js";import"./hidden-nUG2CBH3.js";import"./active-element-history-kuskMK_L.js";import"./calculate-active-index-CCVaqPRQ.js";import"./use-tree-walker-RV405Cqs.js";import"./frozen-AXaDLzzC.js";import"./label-DMEdjN3T.js";import"./useMutation-1JKTR8Dq.js";import"./floating-ui.dom-CtcSe9Ld.js";function $e({id:n,data:t,setValue:E,refetchData:z}){var w;const[_,l]=d.useState(!1),[o,x]=d.useState({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]}),i=se(r=>{r&&_&&(l(!1),z())}),N=()=>{if(o.description&&o.description.trim()&&o.next_date){const r=(t==null?void 0:t.custom_followup_history)||[],f=[...r,{...o,idx:r.length+1}];i.mutate({doctype:"Lead",body:{id:n,custom_followup_history:f,custom_next_follow_up_date:o.next_date,custom_lead_status:"Call Back"}}),E("custom_followup_history",f),x({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})}};return n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Follow-up History Records"}),e.jsxs(m,{onClick:()=>l(!0),color:"primary",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"size-4"}),"Add New Record"]})]}),t!=null&&t.custom_followup_history&&((w=t==null?void 0:t.custom_followup_history)==null?void 0:w.length)>0?e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(me,{hoverable:!0,className:"w-full min-w-[600px] text-left rtl:text-right",children:[e.jsx(xe,{children:e.jsxs(q,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"#"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Created Date"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Description"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Next Follow-up Date"})]})}),e.jsx(pe,{children:t==null?void 0:t.custom_followup_history.map((r,f)=>e.jsxs(q,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:f+1}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:r.created_date?new Date(r.created_date).toLocaleDateString():"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:r.description||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:r.next_date?new Date(r.next_date).toLocaleDateString():"-"})]},f))})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No follow-up records yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(Z,{appear:!0,show:_,as:ee,onClose:()=>l(!1),children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(O,{as:ae,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-lg flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Follow-up History"}),e.jsx("button",{onClick:()=>l(!1),className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(Y,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:o.description,onChange:r=>x({...o,description:r.target.value}),placeholder:"Enter follow-up description...",rows:"4",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Created Date"}),e.jsx("input",{type:"date",value:o.created_date,onChange:r=>x({...o,created_date:r.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Next Follow-up Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:o.next_date,onChange:r=>x({...o,next_date:r.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(m,{variant:"outlined",onClick:()=>{l(!1),x({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})},children:"Cancel"}),e.jsx(m,{color:"primary",onClick:N,disabled:!o.description||!o.description.trim()||!o.next_date,children:"Add Record"})]})]})})]})]}):null}function Ie({id:n,data:t,setValue:E,refetchData:z}){const[_,l]=d.useState(!1),[o,x]=d.useState(!1),[i,N]=d.useState(null),[w,r]=d.useState(!1),[f,S]=d.useState(null),[A,R]=d.useState([]),[M,B]=d.useState([]),[s,c]=d.useState({lead:n||"",customer:(t==null?void 0:t.customer)||"",car_profile:"",approval_manager:"",policy_name:"",status:"Waiting",file_attachment:"",comments:""}),[$,I]=d.useState({doctype:"COD Management",page:1,page_length:100,fields:JSON.stringify(["name","lead","customer","car_profile","approval_manager","policy_name","status","file_attachment","comments","creation","modified"]),filters:n?JSON.stringify([["lead","=",n]]):null}),{data:C,isFetching:u,refetch:b}=Se($);d.useEffect(()=>{n&&(te({doctype:"Car Profile",fields:JSON.stringify(["name","car_make","car_model","car_year"]),filters:JSON.stringify([["lead","=",n],["status","=","New"]]),page_length:100}).then(a=>{if(a!=null&&a.data){const p=a.data.map(k=>({label:`${k.car_make||""} ${k.car_model||""} ${k.car_year||""}`.trim()||k.name,value:k.name}));R(p)}}),te({doctype:"User",fields:JSON.stringify(["name","full_name"]),filters:JSON.stringify([["role_profile_name","=","Lead User"]]),page_length:100}).then(a=>{if(a!=null&&a.data){const p=a.data.map(k=>({label:`${k.full_name||""}`.trim()||k.name,value:k.name}));B(p)}}))},[n]),d.useEffect(()=>{n&&I(a=>({...a,filters:JSON.stringify([["lead","=",n]])}))},[n]),d.useEffect(()=>{C!=null&&C.data?F(C.data):F([])},[C]);const[j,F]=d.useState([]),P=Fe(a=>{a&&(l(!1),y(),b())}),v=se(a=>{a&&(x(!1),N(null),y(),b())}),D=Oe(a=>{a&&a.success&&(r(!1),S(null),b())}),y=()=>{c({lead:n||"",customer:(t==null?void 0:t.customer)||"",car_profile:"",approval_manager:"",policy_name:"",status:"Waiting",file_attachment:"",comments:""})},W=()=>{s.file_attachment&&P.mutate({doctype:"COD Management",body:s})},H=a=>{const p=j.find(k=>k.name===a);p&&(c({lead:p.lead||n||"",customer:p.customer||(t==null?void 0:t.customer)||"",car_profile:p.car_profile||"",approval_manager:p.approval_manager||"",policy_name:p.policy_name||"",status:p.status||"Waiting",file_attachment:p.file_attachment||"",comments:p.comments||""}),N(a),x(!0))},he=()=>{i&&s.file_attachment&&v.mutate({doctype:"COD Management",body:{...s,id:i}})},ge=a=>{S(a),r(!0)},fe=()=>{f&&D.mutate({doctype:"COD Management",ids:[f]})};return d.useEffect(()=>{t!=null&&t.customer&&c(a=>({...a,customer:t.customer}))},[t==null?void 0:t.customer]),n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"COD Document Approvals"}),e.jsxs(m,{onClick:()=>{y(),l(!0)},color:"primary",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"size-4"}),"Approvals Request"]})]}),u?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading COD documents..."}):j&&j.length>0?e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(me,{hoverable:!0,className:"w-full min-w-[900px] text-left rtl:text-right",children:[e.jsx(xe,{children:e.jsxs(q,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Customer"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Car Profile"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Policy Name"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Status"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Approval Manager"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"File Attachment"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Comments"}),e.jsx(h,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Actions"})]})}),e.jsx(pe,{children:j.map(a=>e.jsxs(q,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.customer||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.car_profile||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.policy_name||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:e.jsx("span",{className:T("inline-flex rounded-full px-2 py-1 text-xs font-semibold",a.status==="Approve"&&"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",a.status==="Decline"&&"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",a.status==="Waiting"&&"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"),children:a.status||"-"})}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.approval_manager||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.file_attachment?e.jsx("a",{href:`${V}${a.file_attachment}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400",children:"View File"}):"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.comments||"-"}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{size:"sm",variant:"outlined",onClick:()=>H(a.name),className:"p-1.5",children:e.jsx(ze,{className:"size-4"})}),e.jsx(m,{size:"sm",variant:"outlined",color:"error",onClick:()=>ge(a.name),className:"p-1.5",disabled:D.isPending,children:e.jsx(Re,{className:"size-4"})})]})})]},a.name))})]})})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No COD documents yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(Z,{appear:!0,show:_,as:ee,onClose:()=>{l(!1),y()},children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(O,{as:ae,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Approvals Request"}),e.jsx("button",{onClick:()=>{l(!1),y()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(Y,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(Q,{label:"Car Profile",lists:A,value:s.car_profile,onChange:a=>c({...s,car_profile:a||""}),placeholder:"Select Car Profile",req:!0})}),e.jsx("div",{children:e.jsx(Q,{label:"Approval Manager",lists:M,value:s.approval_manager,onChange:a=>c({...s,approval_manager:a||""}),placeholder:"Select Approval Manager",req:!0})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Policy Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{value:s.policy_name,onChange:a=>c({...s,policy_name:a.target.value}),placeholder:"Enter Policy Name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["File Attachment ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(re,{onChange:a=>{a&&c({...s,file_attachment:a})},children:({...a})=>e.jsxs(m,{...a,unstyled:!0,className:T("mt-3 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-10 border-gray-300 dark:border-dark-450"),children:[e.jsx(de,{className:"size-12"}),e.jsxs("span",{className:T("pointer-events-none mt-2 text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your files here"})]}),s.file_attachment&&e.jsx("span",{className:"mt-2 text-sm text-gray-500 dark:text-dark-300",children:"File selected"})]})}),s.file_attachment&&e.jsx("div",{className:"mt-2 flex flex-col space-y-4",children:e.jsx("div",{className:"relative inline-block",children:e.jsx(le,{size:24,src:`${V}${s.file_attachment}`,classNames:{display:"rounded-lg"}})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:s.comments,onChange:a=>c({...s,comments:a.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(m,{variant:"outlined",onClick:()=>{l(!1),y()},children:"Cancel"}),e.jsx(m,{color:"primary",onClick:W,disabled:!s.file_attachment||P.isPending,children:P.isPending?"Adding...":"Add Document"})]})]})})]}),e.jsxs(Z,{appear:!0,show:o,as:ee,onClose:()=>{x(!1),N(null),y()},children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(O,{as:ae,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Edit COD Document"}),e.jsx("button",{onClick:()=>{x(!1),N(null),y()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(Y,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Customer"}),e.jsx(G,{value:s.customer||"",readOnly:!0,className:"bg-gray-50 dark:bg-dark-600"})]}),e.jsx("div",{children:e.jsx(Q,{label:"Car Profile",lists:A,value:s.car_profile,onChange:a=>c({...s,car_profile:a||""}),placeholder:"Select Car Profile"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Policy Name"}),e.jsx(G,{value:s.policy_name,onChange:a=>c({...s,policy_name:a.target.value}),placeholder:"Enter Policy Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Status"}),e.jsxs(ye,{value:s.status,onChange:a=>c({...s,status:a.target.value}),children:[e.jsx("option",{value:"Waiting",children:"Waiting"}),e.jsx("option",{value:"Approve",children:"Approve"}),e.jsx("option",{value:"Decline",children:"Decline"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["File Attachment ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(re,{onChange:a=>{a&&c({...s,file_attachment:a})},children:({...a})=>e.jsxs(m,{...a,unstyled:!0,className:T("mt-3 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-10 border-gray-300 dark:border-dark-450"),children:[e.jsx(de,{className:"size-12"}),e.jsxs("span",{className:T("pointer-events-none mt-2 text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your files here"})]}),s.file_attachment&&e.jsx("span",{className:"mt-2 text-sm text-gray-500 dark:text-dark-300",children:"File selected"})]})}),s.file_attachment&&e.jsx("div",{className:"mt-2 flex flex-col space-y-4",children:e.jsx("div",{className:"relative inline-block",children:e.jsx(le,{size:24,src:`${V}${s.file_attachment}`,classNames:{display:"rounded-lg"}})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:s.comments,onChange:a=>c({...s,comments:a.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(m,{variant:"outlined",onClick:()=>{x(!1),N(null),y()},children:"Cancel"}),e.jsx(m,{color:"primary",onClick:he,disabled:!s.file_attachment||v.isPending,children:v.isPending?"Updating...":"Update Document"})]})]})})]}),e.jsx(Ee,{show:w,onClose:()=>{r(!1),S(null)},onOk:fe,confirmLoading:D.isPending,state:D.isError?"error":"pending",messages:{pending:{title:"Delete COD Document?",description:"Are you sure you want to delete this COD document? This action cannot be undone.",actionText:"Delete"}}})]}):null}const ie="Lead",X="Lead",J=["first_name","last_name","email_id","mobile_no"],L=["custom_assigned_user","custom_lead_status","custom_next_follow_up_date","source","custom_followup_history"],ce={ignorFields:{status:!0,custom_followup_history:!0}};function na(){const{user:{username:n}}=ke(),{isDark:t,darkColorScheme:E,lightColorScheme:z}=be(),_=je(),{id:l}=Ne(),{data:o,isFetching:x}=Ae({doctype:X,fields:JSON.stringify([...J,...L])}),{data:i,isFetching:N,refetch:w}=Pe({doctype:X,id:l,fields:JSON.stringify([...J,...L])}),[r,f]=d.useState([]),[S,A]=d.useState(!1),R=se(u=>{u&&($(),_(-1))}),{register:M,handleSubmit:B,formState:{errors:s},control:c,reset:$,setValue:I}=_e({resolver:we(Ce(o==null?void 0:o.fields,["status"])),values:l?i:{},defaultValues:Object.fromEntries([...J,...L].map(u=>[u,""]))}),C=async u=>{if(l){const b={...u};R.mutate({doctype:X,body:{...b,id:l}})}else{if(!r||r.length===0){oe({message:"Please add at least one Car Profile before creating the lead."});return}A(!0);try{const b={customer_name:`${u.first_name||""} ${u.last_name||""}`.trim()||"Customer",customer_type:"Individual",email_id:u.email_id||"",mobile_no:u.mobile_no||""},j=await K({doctype:"Customer",body:b});if(!j||!j.name&&!j.id)throw new Error("Failed to create customer");const F=j.name||j.id,P={...u,customer:F,status:"Open",custom_assigned_user:n,custom_lead_status:"New"},v=await K({doctype:"Lead",body:P});if(!v||!v.name&&!v.id)throw new Error("Failed to create lead");const D=v.name||v.id;R.mutate({doctype:"Customer",body:{lead:D,id:F}});const y=r.map(W=>{const H={...W,customer:F,lead:D,status:"New"};return K({doctype:"Car Profile",body:H})});await Promise.all(y),$(),f([]),_(-1)}catch(b){console.error("Error creating lead:",b),oe(b)}finally{A(!1)}}};return x||N?e.jsx(ve,{style:{"--sk-color":t?E[700]:z[300]}}):e.jsx(De,{title:(l?"Edit ":"New ")+ie,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[l?"Edit":"New"," ",ie]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>_(-1),children:"Back"}),e.jsx(m,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",disabled:S,children:S?"Creating...":"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:B(C),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx(Ie,{id:l,data:i,setValue:I,refetchData:w}),e.jsx($e,{id:l,data:i,setValue:I,refetchData:w}),e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(ne,{infos:o,fields:J,register:M,tables:ce,control:c,errors:s})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-5 lg:space-y-6",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsx(ne,{infos:o,tables:ce,fields:L,register:M,control:c,errors:s,readOnlyFields:["custom_lead_status","custom_next_follow_up_date"]})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Te,{leadId:l,customerId:i==null?void 0:i.customer,leadName:(i==null?void 0:i.lead_name)||(i==null?void 0:i.name),isCreateMode:!l,carProfilesToCreate:r,setCarProfilesToCreate:f})})]})]})})}export{na as default};
