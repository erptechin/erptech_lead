import{a as i,j as e,C as Y,B as w,p as Ae,q as Re,s as ue,t as W,v as Ve,w as Z,u as le,S as ne,e as $e,k as Be,x as Je,y as Ue,z as qe}from"./index-2vKqqXQd.js";import{u as ke,o as be}from"./index.esm-reuztDhY.js";import{F as oe,S as je,D as $}from"./dynamicForms-Ds4M2-i0.js";import{P as Oe}from"./Page-C5uJdIsl.js";import{b as ie,u as de,c as ce,d as He,a as We,e as Ze}from"./useApiHook-CognmcbC.js";import{z as B,F as T}from"./transition-BB-9zevn.js";import{y as J,j as U}from"./iconBase-BHtTAgaO.js";import{C as Ge}from"./ConfirmModal-cuAcRUTD.js";import{F as Ke,a as Qe}from"./TrashIcon-CNyHimo8.js";import{F as Xe}from"./DocumentPlusIcon-cHeXBLDh.js";import"./Datepicker-Bl9LCzp4.js";import"./combobox-B_G7LS3r.js";import"./use-by-comparator-D8Qft8rk.js";import"./hidden-4FEgexTP.js";import"./active-element-history-D0hKBeR_.js";import"./calculate-active-index-DKSXSb94.js";import"./use-tree-walker-CbHYW8ul.js";import"./frozen-BzDL2ZTt.js";import"./label-C498X6pc.js";import"./useMutation-C9yNZ49w.js";import"./floating-ui.dom-CtcSe9Ld.js";function Ye({title:t,titleId:a,...l},m){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":a},l),t?i.createElement("title",{id:a},t):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Ie=i.forwardRef(Ye);function Me({title:t,titleId:a,...l},m){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":a},l),t?i.createElement("title",{id:a},t):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const _e=i.forwardRef(Me);function et({id:t,data:a,setValue:l,refetchData:m}){var y;const[s,c]=i.useState(!1),[r,x]=i.useState({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]}),n=ie(d=>{d&&s&&(c(!1),m())}),h=()=>{if(r.description&&r.description.trim()&&r.next_date){const d=(a==null?void 0:a.custom_followup_history)||[],k=[...d,{...r,idx:d.length+1}];n.mutate({doctype:"Lead",body:{id:t,custom_followup_history:k,custom_next_follow_up_date:r.next_date,custom_lead_status:"Call Back"}}),l("custom_followup_history",k),x({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})}};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(Y,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Follow-up History Records"}),e.jsxs(w,{onClick:()=>c(!0),color:"primary",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"size-4"}),"Add New Record"]})]}),a!=null&&a.custom_followup_history&&((y=a==null?void 0:a.custom_followup_history)==null?void 0:y.length)>0?e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(Ae,{hoverable:!0,className:"w-full min-w-[600px] text-left rtl:text-right",children:[e.jsx(Re,{children:e.jsxs(ue,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(W,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"#"}),e.jsx(W,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Created Date"}),e.jsx(W,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Description"}),e.jsx(W,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Next Follow-up Date"})]})}),e.jsx(Ve,{children:a==null?void 0:a.custom_followup_history.map((d,k)=>e.jsxs(ue,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(Z,{className:"text-gray-700 dark:text-dark-200",children:k+1}),e.jsx(Z,{className:"text-gray-700 dark:text-dark-200",children:d.created_date?new Date(d.created_date).toLocaleDateString():"-"}),e.jsx(Z,{className:"text-gray-700 dark:text-dark-200",children:d.description||"-"}),e.jsx(Z,{className:"text-gray-700 dark:text-dark-200",children:d.next_date?new Date(d.next_date).toLocaleDateString():"-"})]},k))})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No follow-up records yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(B,{appear:!0,show:s,as:J,onClose:()=>c(!1),children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(T,{as:U,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-lg flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Follow-up History"}),e.jsx("button",{onClick:()=>c(!1),className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(oe,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:r.description,onChange:d=>x({...r,description:d.target.value}),placeholder:"Enter follow-up description...",rows:"4",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Created Date"}),e.jsx("input",{type:"date",value:r.created_date,onChange:d=>x({...r,created_date:d.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Next Follow-up Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:r.next_date,onChange:d=>x({...r,next_date:d.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(w,{variant:"outlined",onClick:()=>{c(!1),x({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})},children:"Cancel"}),e.jsx(w,{color:"primary",onClick:h,disabled:!r.description||!r.description.trim()||!r.next_date,children:"Add Record"})]})]})})]})]}):null}const G="Plot Detail",Ne=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],ve=["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],we=["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],Fe=["plot_status","booking_date","sale_date","handover_date","remarks"],re=[...Ne,...ve,...we,...Fe],K={ignorFields:{}},ee=Object.fromEntries(re.map(t=>[t,""]));function tt({isOpen:t,onClose:a,carProfileId:l,carProfileData:m=null,customerId:s,customerName:c,leadId:r,leadName:x,isCreateMode:n=!1,onSuccess:h}){const{isDark:y,darkColorScheme:d,lightColorScheme:k}=le(),{data:b,isFetching:F}=de({doctype:G,fields:JSON.stringify(re)}),{data:S,isFetching:E,refetch:R}=ce({doctype:G,id:t&&l&&!n?l:null,fields:JSON.stringify(re)});i.useEffect(()=>{t&&l&&!n&&R()},[t,l,n,R]);const p=He(()=>{D(),h&&h(),a()}),j=ie(()=>{D(),h&&h(),a()}),{register:_,handleSubmit:L,formState:{errors:z,isSubmitting:N},control:u,reset:D,setValue:A}=ke({resolver:be(je(b==null?void 0:b.fields)),defaultValues:ee,mode:"onChange"});i.useEffect(()=>{t?n&&m?D(m):l&&!n?S&&D(S):(D(ee),n||(s&&A("customer",s),r?A("lead",r):x&&A("lead",x))):D(ee)},[t,l,m,n,S,s,c,r,x,D,A]);const V=C=>{if(console.log("Form submitted with data:",C),n){const O={...C};(r||x)&&(O.status="New"),h&&h(O);return}const g={...C};g.lead=r,g.customer=s,console.log("Submitting with data:",g),l?(console.log("Calling mutationUpdate..."),j.mutate({doctype:G,body:{...g,id:l}})):(g.status="New",console.log("Calling mutationAdd..."),p.mutate({doctype:G,body:g}))},q=C=>{console.log("Form validation errors:",C)};return F||t&&l&&!n&&E?e.jsx(B,{show:t,children:e.jsxs(J,{open:t,onClose:a,static:!1,autoFocus:!0,children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!p.isPending&&!j.isPending&&a()}}),e.jsx(T,{as:U,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[l?"Edit":"New"," Plot Detail"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsx(ne,{style:{"--sk-color":y?d[700]:k[300]}})})]})})]})}):e.jsx(B,{show:t,children:e.jsxs(J,{open:t,onClose:C=>{!p.isPending&&!j.isPending&&a()},static:p.isPending||j.isPending,autoFocus:!0,children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!p.isPending&&!j.isPending&&a()}}),e.jsxs(T,{as:U,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[l?"Edit":"New"," Plot Detail"]}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(oe,{className:"size-5"})})]}),e.jsxs("form",{onSubmit:L(V,q),className:"flex min-h-0 flex-1 flex-col overflow-hidden",noValidate:!0,children:[e.jsx("div",{className:"scrollbar-sm flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-5 sm:gap-5 lg:gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Basic Plot Details"}),e.jsx($,{infos:b,fields:Ne,register:_,tables:K,control:u,errors:z})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Ownership & Legal"}),e.jsx($,{infos:b,fields:ve,register:_,tables:K,control:u,errors:z})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Financial Details"}),e.jsx($,{infos:b,fields:we,register:_,tables:K,control:u,errors:z})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Status Tracking"}),e.jsx($,{infos:b,fields:Fe,register:_,tables:K,control:u,errors:z})]})]})]})}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(w,{variant:"outlined",onClick:a,children:"Cancel"}),e.jsx(w,{color:"primary",type:"button",onClick:L(V,q),disabled:N||p.isPending||j.isPending,children:N||p.isPending||j.isPending?"Saving...":l?"Update":"Create"})]})]})]})]})})}const pe="Plot Detail",te=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],ae=["status","owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status","rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","buyer_name","contact_number","email_id","address","agent_reference_name","plot_status","booking_date","sale_date","handover_date","remarks"],he=(t,a)=>{var m;const l=(m=t==null?void 0:t.fields)==null?void 0:m.find(s=>s.fieldname===a);return(l==null?void 0:l.label)||a},ge=t=>t==null||t===""?"-":t;function at({isOpen:t,onClose:a,carProfileId:l}){const{isDark:m,darkColorScheme:s,lightColorScheme:c}=le(),{data:r,isFetching:x}=de({doctype:pe,fields:JSON.stringify([...te,...ae])}),{data:n,isFetching:h,refetch:y}=ce({doctype:pe,id:t&&l?l:null,fields:JSON.stringify([...te,...ae])});return i.useEffect(()=>{t&&l&&y()},[t,l,y]),x||t&&l&&h?e.jsx(B,{show:t,children:e.jsxs(J,{open:t,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs(T,{as:U,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl dark:bg-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 pb-4 dark:border-dark-500",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Plot Detail"})}),e.jsx("div",{className:"mt-4",children:e.jsx(ne,{style:{"--sk-color":m?s[700]:c[300]}})})]})]})}):n?e.jsx(B,{show:t,children:e.jsxs(J,{open:t,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs(T,{as:U,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"scrollbar-sm relative flex max-h-[90vh] w-full max-w-4xl flex-col overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-dark-700",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(oe,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Car Information"}),e.jsx("div",{className:"space-y-3",children:te.map(d=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:he(r,d)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:ge(n[d])})]},d))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Additional Information"}),e.jsx("div",{className:"space-y-3",children:ae.map(d=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:he(r,d)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:ge(n[d])})]},d))})]})]})}),e.jsx("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 dark:border-dark-500",children:e.jsx(w,{color:"primary",onClick:a,children:"Close"})})]})]})}):null}function st({customerId:t,customerName:a,leadId:l,leadName:m,isCreateMode:s=!1,carProfilesToCreate:c=[],setCarProfilesToCreate:r=null}){const x=a?"customer":"lead",n=x==="customer"?t:l,[h,y]=i.useState(!1),[d,k]=i.useState(!1),[b,F]=i.useState(null),[S,E]=i.useState(null),[R,p]=i.useState(!1),[j,_]=i.useState(null),[L,z]=i.useState(null),N=i.useMemo(()=>["name","lead","lead_status","plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],[]),u=i.useMemo(()=>["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],[]),D=i.useMemo(()=>["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],[]),A=i.useMemo(()=>["plot_status","booking_date","sale_date","handover_date","remarks"],[]),V=i.useMemo(()=>[...N,...u,...D,...A],[N,u,D,A]),[q,C]=i.useState({doctype:"Plot Detail",page:1,page_length:10,fields:s?null:JSON.stringify(V),filters:null}),{data:g,isFetching:O,refetch:xe}=We(q),[I,M]=i.useState([]);i.useEffect(()=>{if(!s&&n){const o=[[x,"=",n]];x==="lead"?o.push(["lead_status","in",["New","Pending"]]):x==="customer"&&(o.push(["lead_status","!=","New"]),o.push(["lead_status","!=","Pending"]));const f=JSON.stringify(V),v=JSON.stringify(o);C(P=>P.filters===v&&P.fields===f?P:{...P,filters:v,fields:f})}},[n,x,s,V]),i.useEffect(()=>{s?M(c||[]):g!=null&&g.data?M(g.data):M([])},[s,c,g==null?void 0:g.data]);const Se=()=>{F(null),E(null),y(!0)},me=()=>{y(!1),F(null),E(null)},De=()=>{k(!1),F(null),E(null)},Pe=o=>{if(s&&r)if(S!==null){const f=[...c];f[S]=o,r(f)}else r([...c,o]);else xe();me()},H=Ze(o=>{o&&o.success&&(p(!1),_(null),xe())}),Te=(o,f,v=null)=>{o.stopPropagation(),F(f),E(v),y(!0)},Ee=(o,f)=>{o.stopPropagation(),F(f),k(!0)},ze=(o,f,v=null)=>{o.stopPropagation(),_(f),z(v),p(!0)},Ce=()=>{if(s&&r&&L!==null){const o=c.filter((f,v)=>v!==L);r(o),p(!1),_(null),z(null)}else j&&H.mutate({doctype:"Plot Detail",ids:[j]})},Le=()=>{p(!1),_(null)};return e.jsxs(Y,{className:"p-4 sm:px-5",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-dark-50",children:"Plot Details"}),(x==="lead"||s)&&e.jsxs(w,{size:"sm",color:"primary",onClick:Se,className:"flex items-center gap-2",children:[e.jsx(_e,{className:"size-4"}),"Add Plot Detail"]})]}),!s&&!n?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading information..."}):!s&&O?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading plot details..."}):I.length===0?e.jsx("div",{className:"py-8 text-center text-sm text-gray-500 dark:text-dark-300",children:s?"No plot details added yet. Please add at least one plot detail before creating the lead.":`No plot details found ${x==="customer"?"for this customer":"for this lead"}.`}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-dark-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Project/Layout"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Lead Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-dark-200",children:[...I].reverse().map((o,f)=>{const v=I.length-1-f;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-dark-100 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.plot_no||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.plot_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.project_layout_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.location_village||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.plot_size||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.total_plot_value?`AED ${parseFloat(o.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.plot_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:o.lead_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!s&&e.jsx(w,{size:"sm",variant:"outlined",onClick:P=>Ee(P,o.name),className:"p-1.5",children:e.jsx(Ie,{className:"size-4"})}),(x==="lead"||s)&&e.jsx(w,{size:"sm",variant:"outlined",onClick:P=>Te(P,s?null:o.name,s?v:null),className:"p-1.5",children:e.jsx(Ke,{className:"size-4"})}),e.jsx(w,{size:"sm",variant:"outlined",color:"error",onClick:P=>ze(P,s?null:o.name,s?v:null),className:"p-1.5",disabled:!s&&H.isPending,children:e.jsx(Qe,{className:"size-4"})})]})})]},s?v:o.name)})})]})}),e.jsx(tt,{isOpen:h,onClose:me,carProfileId:b,carProfileData:s&&S!==null?c[S]:null,customerId:t,customerName:a,leadId:l,leadName:m,isCreateMode:s,onSuccess:Pe}),e.jsx(at,{isOpen:d,onClose:De,carProfileId:b}),e.jsx(Ge,{show:R,onClose:Le,onOk:Ce,confirmLoading:H.isPending,state:H.isError?"error":"pending",messages:{pending:{title:"Delete Plot Detail?",description:"Are you sure you want to delete this plot detail? This action cannot be undone.",actionText:"Delete"}}})]})}const fe="Lead",se="Lead",Q=["first_name","last_name","email_id","mobile_no","custom_address"],X=["custom_next_follow_up_date","source","custom_followup_history","custom_assigned_user","custom_lead_status"],ye={ignorFields:{status:!0,custom_followup_history:!0}};function wt(){const{user:{username:t}}=$e(),{isDark:a,darkColorScheme:l,lightColorScheme:m}=le(),s=Be(),{id:c}=Je(),{data:r,isFetching:x}=de({doctype:se,fields:JSON.stringify([...Q,...X])}),{data:n,isFetching:h,refetch:y}=ce({doctype:se,id:c,fields:JSON.stringify([...Q,...X])}),[d,k]=i.useState([]),[b,F]=i.useState(!1),S=ie(N=>{N&&(_(),s(-1))}),{register:E,handleSubmit:R,formState:{errors:p},control:j,reset:_,setValue:L}=ke({resolver:be(je(r==null?void 0:r.fields,["status"])),values:c?n:{},defaultValues:Object.fromEntries([...Q,...X].map(N=>[N,""]))}),z=async N=>{if(c){const u={...N};S.mutate({doctype:se,body:{...u,id:c}})}else{F(!0);try{const u=await Ue(N,d,t);if(!u||!u.lead_id&&!u.customer_id)throw new Error("Failed to create lead");_(),k([]),s(-1)}catch(u){console.error("Error creating lead:",u),qe(u)}finally{F(!1)}}};return x||h?e.jsx(ne,{style:{"--sk-color":a?l[700]:m[300]}}):e.jsx(Oe,{title:(c?"Edit ":"New ")+fe,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[c?"Edit":"New"," ",fe]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>s(-1),children:"Back"}),e.jsx(w,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",disabled:b,children:b?"Creating...":"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:R(z),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx(et,{id:c,data:n,setValue:L,refetchData:y}),e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(Y,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx($,{infos:r,fields:Q,register:E,tables:ye,control:j,errors:p})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-5 lg:space-y-6",children:e.jsx(Y,{className:"p-4 sm:px-5",children:e.jsx($,{infos:r,tables:ye,fields:X,register:E,control:j,errors:p,readOnlyFields:["custom_lead_status","custom_next_follow_up_date"]})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(st,{leadId:c,customerId:n==null?void 0:n.customer,leadName:(n==null?void 0:n.lead_name)||(n==null?void 0:n.name),isCreateMode:!c,carProfilesToCreate:d,setCarProfilesToCreate:k})})]})]})})}export{wt as default};
