import{a as l,j as e,C as te,B as y,k as Pe,l as $e,n as ce,o as q,p as Ee,q as B,s as we,t as ie,v as Xe,w as Y,x as Ye,u as be,S as je,I as et,U as tt,J as ye,e as at,y as st,z as rt,D as lt}from"./index-BoCzCk_E.js";import{u as Te,o as ze,a as nt,C as ot}from"./index.esm-BLzqCPUM.js";import{F as ae,S as se,a as Le,D as ee,b as it}from"./dynamicForms-D1n6YyJg.js";import{P as dt}from"./Page-CHRf9ovH.js";import{b as me,y as I,j as H,a as Oe,c as Ue,d as Re,C as Me,u as Ne,e as ve}from"./ConfirmModal-BR2_0OO_.js";import{z as Z,F as O}from"./transition-CBVadWHH.js";import{F as Je,a as _e}from"./TrashIcon-BlFTEv27.js";import{F as ct}from"./DocumentPlusIcon-D2KOZ4GY.js";import"./iconBase-BIxOzkjH.js";import"./use-event-listener-aRyzntPF.js";import"./Datepicker-C8HgCOOX.js";import"./combobox-BT3r_8m7.js";import"./use-by-comparator-DF_ef1co.js";import"./calculate-active-index-C4R1c-E8.js";import"./useMutation-C15RvZAa.js";import"./floating-ui.dom-CtcSe9Ld.js";function mt({title:s,titleId:a,...i},u){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":a},i),s?l.createElement("title",{id:a},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const xt=l.forwardRef(mt);function ut({title:s,titleId:a,...i},u){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":a},i),s?l.createElement("title",{id:a},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const xe=l.forwardRef(ut);function pt({title:s,titleId:a,...i},u){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":a},i),s?l.createElement("title",{id:a},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"}))}const qe=l.forwardRef(pt);function gt({id:s,data:a,setValue:i,refetchData:u}){var r;const[o,f]=l.useState(!1),[c,n]=l.useState({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]}),h=me(p=>{p&&o&&(f(!1),u())}),A=()=>{if(c.description&&c.description.trim()&&c.next_date){const p=(a==null?void 0:a.custom_followup_history)||[],D=[...p,{...c,idx:p.length+1}];h.mutate({doctype:"Lead",body:{id:s,custom_followup_history:D,custom_next_follow_up_date:c.next_date,custom_lead_status:"Call Back"}}),i("custom_followup_history",D),n({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})}};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Follow-up History Records"}),e.jsxs(y,{onClick:()=>f(!0),color:"primary",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"size-4"}),"Add New Record"]})]}),a!=null&&a.custom_followup_history&&((r=a==null?void 0:a.custom_followup_history)==null?void 0:r.length)>0?e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(Pe,{hoverable:!0,className:"w-full min-w-[600px] text-left rtl:text-right",children:[e.jsx($e,{children:e.jsxs(ce,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"#"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Created Date"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Description"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Next Follow-up Date"})]})}),e.jsx(Ee,{children:a==null?void 0:a.custom_followup_history.map((p,D)=>e.jsxs(ce,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:D+1}),e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:p.created_date?new Date(p.created_date).toLocaleDateString():"-"}),e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:p.description||"-"}),e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:p.next_date?new Date(p.next_date).toLocaleDateString():"-"})]},D))})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No follow-up records yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(Z,{appear:!0,show:o,as:I,onClose:()=>f(!1),children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(O,{as:H,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-lg flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Follow-up History"}),e.jsx("button",{onClick:()=>f(!1),className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:c.description,onChange:p=>n({...c,description:p.target.value}),placeholder:"Enter follow-up description...",rows:"4",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Created Date"}),e.jsx("input",{type:"date",value:c.created_date,onChange:p=>n({...c,created_date:p.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Next Follow-up Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:c.next_date,onChange:p=>n({...c,next_date:p.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:()=>{f(!1),n({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})},children:"Cancel"}),e.jsx(y,{color:"primary",onClick:A,disabled:!c.description||!c.description.trim()||!c.next_date,children:"Add Record"})]})]})})]})]}):null}function ht({id:s,data:a}){const[i,u]=l.useState(!1),[o,f]=l.useState(!1),[c,n]=l.useState(null),[h,A]=l.useState(!1),[r,p]=l.useState(null),[D,P]=l.useState([]),[E,x]=l.useState([]),[g,k]=l.useState({lead:s||"",customer:(a==null?void 0:a.customer)||"",plot_detail:"",approval_manager:"",status:"Waiting",comments:""}),[F,b]=l.useState({doctype:"Management",page:1,page_length:100,fields:JSON.stringify(["name","lead","customer","plot_detail","approval_manager","status","comments","creation","modified"]),filters:s?JSON.stringify([["lead","=",s],["status","=","Waiting"]]):null}),{data:v,isFetching:U,refetch:j}=Oe(F);l.useEffect(()=>{s&&(we({doctype:"Plot Detail",fields:JSON.stringify(["name","plot_no","plot_id","project_layout_name","location_village"]),filters:JSON.stringify([["lead","=",s],["lead_status","=","New"]]),page_length:100}).then(t=>{if(t!=null&&t.data){const w=t.data.map(z=>({label:`${z.plot_no||""}`.trim()||z.plot_id||z.name,value:z.name}));P(w)}}),we({doctype:"User",fields:JSON.stringify(["name","full_name"]),filters:JSON.stringify([["role_profile_name","=","Lead Manager"]]),page_length:100}).then(t=>{if(t!=null&&t.data){const w=t.data.map(z=>({label:`${z.full_name||""}`.trim()||z.name,value:z.name}));x(w)}}))},[s]),l.useEffect(()=>{s&&b(t=>({...t,filters:JSON.stringify([["lead","=",s],["status","=","Waiting"]])}))},[s]),l.useEffect(()=>{v!=null&&v.data?T(v.data):T([])},[v]);const[R,T]=l.useState([]),[_,S]=l.useState(!1),[V,G]=l.useState(!1);Ue(t=>{t&&(u(!1),N(),j())}),me(t=>{t&&(f(!1),n(null),N(),j())});const W=Re(t=>{t&&t.success&&(A(!1),p(null),j())}),N=()=>{k({lead:s||"",customer:(a==null?void 0:a.customer)||"",plot_detail:"",approval_manager:"",status:"Waiting",type:"New",comments:""})},K=async()=>{S(!0);try{const t=await Xe(g);t&&t.cod_id?(u(!1),N(),j()):Y({message:"Failed to create Management"})}catch(t){console.error("Error creating Management:",t),Y(t)}finally{S(!1)}},$=t=>{const w=R.find(z=>z.name===t);w&&(k({lead:w.lead||s||"",customer:w.customer||(a==null?void 0:a.customer)||"",plot_detail:w.plot_detail||"",approval_manager:w.approval_manager||"",status:w.status||"Waiting",comments:w.comments||""}),n(t),f(!0))},C=async()=>{if(!c){Y({message:"Management ID is required"});return}G(!0);try{const t=await Ye(c,g);t&&t.cod_id?(f(!1),n(null),N(),j()):Y({message:"Failed to update Management"})}catch(t){console.error("Error updating Management:",t),Y(t)}finally{G(!1)}},J=t=>{p(t),A(!0)},Q=()=>{r&&W.mutate({doctype:"Management",ids:[r]})};return l.useEffect(()=>{a!=null&&a.customer&&k(t=>({...t,customer:a.customer}))},[a==null?void 0:a.customer]),s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Document Approvals"}),e.jsxs(y,{onClick:()=>{N(),u(!0)},color:"primary",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"size-4"}),"Approvals Request"]})]}),U?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading documents..."}):R&&R.length>0?e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(Pe,{hoverable:!0,className:"w-full min-w-[900px] text-left rtl:text-right",children:[e.jsx($e,{children:e.jsxs(ce,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Customer"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Plot Detail"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Status"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Approval Manager"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Comments"}),e.jsx(q,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Actions"})]})}),e.jsx(Ee,{children:R.map(t=>e.jsxs(ce,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:t.customer||"-"}),e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:t.plot_detail||"-"}),e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:e.jsx("span",{className:ie("inline-flex rounded-full px-2 py-1 text-xs font-semibold",t.status==="Approve"&&"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",t.status==="Decline"&&"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",t.status==="Waiting"&&"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"),children:t.status||"-"})}),e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:t.approval_manager||"-"}),e.jsx(B,{className:"text-gray-700 dark:text-dark-200",children:t.comments||"-"}),e.jsx(B,{children:t.status!=="Approve"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{size:"sm",variant:"outlined",onClick:()=>$(t.name),className:"p-1.5",children:e.jsx(Je,{className:"size-4"})}),e.jsx(y,{size:"sm",variant:"outlined",color:"error",onClick:()=>J(t.name),className:"p-1.5",disabled:W.isPending,children:e.jsx(_e,{className:"size-4"})})]})})]},t.name))})]})})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No documents yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(Z,{appear:!0,show:i,as:I,onClose:()=>{u(!1),N()},children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(O,{as:H,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Approvals Request"}),e.jsx("button",{onClick:()=>{u(!1),N()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(se,{label:"Plot Detail",lists:D,value:g.plot_detail,onChange:t=>k({...g,plot_detail:t||""}),placeholder:"Select Plot Detail",req:!0})}),e.jsx("div",{children:e.jsx(se,{label:"Approval Manager",lists:E,value:g.approval_manager,onChange:t=>k({...g,approval_manager:t||""}),placeholder:"Select Approval Manager",req:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:g.comments,onChange:t=>k({...g,comments:t.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:()=>{u(!1),N()},children:"Cancel"}),e.jsx(y,{color:"primary",onClick:K,disabled:_,children:_?"Adding...":"Add Document"})]})]})})]}),e.jsxs(Z,{appear:!0,show:o,as:I,onClose:()=>{f(!1),n(null),N()},children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(O,{as:H,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Edit Document"}),e.jsx("button",{onClick:()=>{f(!1),n(null),N()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(se,{label:"Plot Detail",lists:D,value:g.plot_detail,onChange:t=>k({...g,plot_detail:t||""}),placeholder:"Select Plot Detail"})}),e.jsx("div",{children:e.jsx(se,{label:"Approval Manager",lists:E,value:g.approval_manager,onChange:t=>k({...g,approval_manager:t||""}),placeholder:"Select Approval Manager"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:g.comments,onChange:t=>k({...g,comments:t.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:()=>{f(!1),n(null),N()},children:"Cancel"}),e.jsx(y,{color:"primary",onClick:C,disabled:V,children:V?"Updating...":"Update Document"})]})]})})]}),e.jsx(Me,{show:h,onClose:()=>{A(!1),p(null)},onOk:Q,confirmLoading:W.isPending,state:W.isError?"error":"pending",messages:{pending:{title:"Delete Management Document?",description:"Are you sure you want to delete this management document? This action cannot be undone.",actionText:"Delete"}}})]}):null}const re="Plot Detail",Be=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],Ve=["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],We=["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],Ie=["plot_status","booking_date","sale_date","handover_date","remarks"],ke=[...Be,...Ve,...We,...Ie],le={ignorFields:{plot_document:!0}},de=Object.fromEntries(ke.map(s=>[s,""]));de.plot_document=[];function ft({isOpen:s,onClose:a,carProfileId:i,carProfileData:u=null,customerId:o,customerName:f,leadId:c,leadName:n,isCreateMode:h=!1,onSuccess:A}){const{isDark:r,darkColorScheme:p,lightColorScheme:D}=be(),{data:P,isFetching:E}=Ne({doctype:re,fields:JSON.stringify(ke)}),{data:x,isFetching:g,refetch:k}=ve({doctype:re,id:s&&i&&!h?i:null,fields:JSON.stringify(ke)});l.useEffect(()=>{s&&i&&!h&&k()},[s,i,h,k]);const F=Ue(()=>{_(),A&&A(),a()}),b=me(()=>{_(),A&&A(),a()}),{register:v,handleSubmit:U,formState:{errors:j,isSubmitting:R},control:T,reset:_,setValue:S}=Te({resolver:ze(Le(P==null?void 0:P.fields)),defaultValues:de,mode:"onChange"}),{fields:V,append:G,remove:W}=nt({control:T,name:"plot_document"});l.useEffect(()=>{if(s)if(h&&u){const $={...u,plot_document:Array.isArray(u.plot_document)?u.plot_document:[]};_($)}else if(i&&!h){if(x){const $={...x,plot_document:Array.isArray(x.plot_document)?x.plot_document:[]};_($)}}else _(de),h||(o&&S("customer",o),c?S("lead",c):n&&S("lead",n));else _(de)},[s,i,u,h,x,o,f,c,n,_,S]);const N=$=>{if(console.log("Form submitted with data:",$),h){const J={...$};(c||n)&&(J.status="New"),A&&A(J);return}const C={...$};C.lead=c,C.customer=o,console.log("Submitting with data:",C),i?(console.log("Calling mutationUpdate..."),b.mutate({doctype:re,body:{...C,id:i}})):(C.status="New",console.log("Calling mutationAdd..."),F.mutate({doctype:re,body:C}))},K=$=>{console.log("Form validation errors:",$)};return E||s&&i&&!h&&g?e.jsx(Z,{show:s,children:e.jsxs(I,{open:s,onClose:a,static:!1,autoFocus:!0,children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!F.isPending&&!b.isPending&&a()}}),e.jsx(O,{as:H,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[i?"Edit":"New"," Plot Detail"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsx(je,{style:{"--sk-color":r?p[700]:D[300]}})})]})})]})}):e.jsx(Z,{show:s,children:e.jsxs(I,{open:s,onClose:$=>{!F.isPending&&!b.isPending&&a()},static:F.isPending||b.isPending,autoFocus:!0,children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!F.isPending&&!b.isPending&&a()}}),e.jsxs(O,{as:H,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[i?"Edit":"New"," Plot Detail"]}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsxs("form",{onSubmit:U(N,K),className:"flex min-h-0 flex-1 flex-col overflow-hidden",noValidate:!0,children:[e.jsxs("div",{className:"scrollbar-sm flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-5 sm:gap-5 lg:gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Basic Plot Details"}),e.jsx(ee,{infos:P,fields:Be,register:v,tables:le,control:T,errors:j})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Ownership & Legal"}),e.jsx(ee,{infos:P,fields:Ve,register:v,tables:le,control:T,errors:j})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Financial Details"}),e.jsx(ee,{infos:P,fields:We,register:v,tables:le,control:T,errors:j})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Status Tracking"}),e.jsx(ee,{infos:P,fields:Ie,register:v,tables:le,control:T,errors:j})]})]})]}),e.jsxs("div",{className:"px-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b pb-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-dark-100",children:"Plot Documents"}),e.jsxs(y,{type:"button",variant:"flat",size:"sm",onClick:()=>G({title:"",file:""}),className:"gap-1",children:[e.jsx(xe,{className:"size-4"}),"Add Document"]})]}),e.jsxs("div",{className:"space-y-4",children:[V.map(($,C)=>{var J,Q,t;return e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4 dark:border-dark-500",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-dark-300",children:["Document ",C+1]}),e.jsxs(y,{type:"button",variant:"flat",size:"sm",color:"error",onClick:()=>W(C),className:"gap-1",children:[e.jsx(_e,{className:"size-4"}),"Remove"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{label:"Title",placeholder:"Enter document title",...v(`plot_document.${C}.title`),error:(t=(Q=(J=j==null?void 0:j.plot_document)==null?void 0:J[C])==null?void 0:Q.title)==null?void 0:t.message}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-200",children:"File"}),e.jsx(ot,{name:`plot_document.${C}.file`,control:T,render:({field:{value:w,onChange:z}})=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:ie("flex-1",w&&"max-w-[60%]"),children:e.jsx(tt,{onChange:z,accept:"image/*",children:({onClick:X,disabled:ue,...pe})=>e.jsxs(y,{...pe,type:"button",unstyled:!0,onClick:X,disabled:ue,className:ie("mt-1 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-6 border-gray-300 dark:border-dark-450","hover:border-primary-400 dark:hover:border-primary-500"),children:[e.jsx(it,{className:"size-8 text-gray-400 dark:text-dark-400"}),e.jsxs("span",{className:ie("pointer-events-none mt-2 text-sm text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your file here"})]}),w&&e.jsx("span",{className:"mt-2 text-xs text-gray-500 dark:text-dark-300",children:"File selected"})]})})}),w&&e.jsx("div",{className:"mt-1 flex-shrink-0",children:e.jsx("img",{src:w.startsWith("http")?w:`${ye}${w}`,alt:"Preview",className:"h-32 w-32 rounded border border-gray-200 object-cover dark:border-dark-500"})})]})})]})]})]},$.id)}),V.length===0&&e.jsx("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center dark:border-dark-500",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:'No documents added. Click "Add Document" to add one.'})})]})]})]}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:a,children:"Cancel"}),e.jsx(y,{color:"primary",type:"button",onClick:U(N,K),disabled:R||F.isPending||b.isPending,children:R||F.isPending||b.isPending?"Saving...":i?"Update":"Create"})]})]})]})]})})}const De="Plot Detail",ge=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],he=["status","owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status","rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","buyer_name","contact_number","email_id","address","agent_reference_name","plot_status","booking_date","sale_date","handover_date","remarks"],Fe=["plot_document"],Se=(s,a)=>{var u;const i=(u=s==null?void 0:s.fields)==null?void 0:u.find(o=>o.fieldname===a);return(i==null?void 0:i.label)||a},Ae=s=>s==null||s===""?"-":s;function yt({isOpen:s,onClose:a,carProfileId:i}){var E;const[u,o]=l.useState(null),{isDark:f,darkColorScheme:c,lightColorScheme:n}=be(),{data:h,isFetching:A}=Ne({doctype:De,fields:JSON.stringify([...ge,...he,...Fe])}),{data:r,isFetching:p,refetch:D}=ve({doctype:De,id:s&&i?i:null,fields:JSON.stringify([...ge,...he,...Fe])});l.useEffect(()=>{s&&i&&D()},[s,i,D]);const P=()=>{if(!r)return;const x=r!=null&&r.plot_document&&Array.isArray(r.plot_document)&&r.plot_document.length>0?r.plot_document.map((b,v)=>{const U=(b==null?void 0:b.title)||`Document ${v+1}`,j=b!=null&&b.file?`${ye}${b.file}`:"";return j?`  • ${U}: ${j}`:`  • ${U}`}).join(`
`):"N/A",g=["*Plot Details*","━━━━━━━━━━━━━━━━━━━━",`*Plot No:* ${r.plot_no||"N/A"}`,`*Plot ID:* ${r.plot_id||"N/A"}`,`*Project/Layout:* ${r.project_layout_name||"N/A"}`,`*Location:* ${r.location_village||"N/A"}`,`*Plot Size:* ${r.plot_size||"N/A"}`,`*Plot Type:* ${r.plot_type||"N/A"}`,`*Facing:* ${r.facing||"N/A"}`,`*Total Value:* ${r.total_plot_value?`AED ${parseFloat(r.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Rate per Sqft:* ${r.rate_per_sqft?`AED ${parseFloat(r.rate_per_sqft).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Booking Amount:* ${r.booking_amount?`AED ${parseFloat(r.booking_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Paid Amount:* ${r.paid_amount?`AED ${parseFloat(r.paid_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Balance Amount:* ${r.balance_amount?`AED ${parseFloat(r.balance_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Plot Status:* ${r.plot_status||"N/A"}`,r.remarks?`*Remarks:* ${r.remarks}`:"",`
*Plot Documents:*`,x].filter(Boolean).join(`
`),F=`https://wa.me/?text=${encodeURIComponent(g)}`;window.open(F,"_blank")};return A||s&&i&&p?e.jsx(Z,{show:s,children:e.jsxs(I,{open:s,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs(O,{as:H,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl dark:bg-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 pb-4 dark:border-dark-500",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Plot Detail"})}),e.jsx("div",{className:"mt-4",children:e.jsx(je,{style:{"--sk-color":f?c[700]:n[300]}})})]})]})}):r?e.jsx(Z,{show:s,children:e.jsxs(I,{open:s,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(O,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs(O,{as:H,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"scrollbar-sm relative flex max-h-[90vh] w-full max-w-4xl flex-col overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-dark-700",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Car Information"}),e.jsx("div",{className:"space-y-3",children:ge.map(x=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:Se(h,x)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:Ae(r[x])})]},x))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Additional Information"}),e.jsx("div",{className:"space-y-3",children:he.map(x=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:Se(h,x)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:Ae(r[x])})]},x))})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Plot Documents"}),e.jsx("div",{className:"space-y-3",children:(E=r==null?void 0:r.plot_document)==null?void 0:E.map((x,g)=>{const k=ye+(x==null?void 0:x.file);return k?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300 mb-1",children:x==null?void 0:x.title}),e.jsx("button",{type:"button",onClick:()=>o(k),className:"inline-flex w-max overflow-hidden rounded-md border border-gray-200 bg-gray-50 hover:bg-gray-100 dark:border-dark-500 dark:bg-dark-600 dark:hover:bg-dark-500",children:e.jsx("img",{src:k,alt:k,className:"h-24 w-24 object-cover"})})]},g):null})})]})})]}),u&&e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/70",onClick:()=>o(null),children:e.jsx("div",{className:"max-h-[90vh] max-w-[90vw] overflow-hidden rounded-lg bg-white p-2 dark:bg-dark-700",onClick:x=>x.stopPropagation(),children:e.jsx("img",{src:u,alt:"Document preview",className:"max-h-[80vh] max-w-[80vw] object-contain"})})}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsxs(y,{variant:"outlined",onClick:P,className:"flex items-center gap-2",children:[e.jsx(qe,{className:"size-4"}),"Share"]}),e.jsx(y,{color:"primary",onClick:a,children:"Close"})]})]})]})}):null}function kt({customerId:s,customerName:a,leadId:i,leadName:u,isCreateMode:o=!1,carProfilesToCreate:f=[],setCarProfilesToCreate:c=null}){const n=a?"customer":"lead",h=n==="customer"?s:i,[A,r]=l.useState(!1),[p,D]=l.useState(!1),[P,E]=l.useState(null),[x,g]=l.useState(null),[k,F]=l.useState(!1),[b,v]=l.useState(null),[U,j]=l.useState(null),R=l.useMemo(()=>["name","lead","lead_status","plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],[]),T=l.useMemo(()=>["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],[]),_=l.useMemo(()=>["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],[]),S=l.useMemo(()=>["plot_status","booking_date","sale_date","handover_date","remarks"],[]),V=l.useMemo(()=>[...R,...T,..._,...S],[R,T,_,S]),[G,W]=l.useState({doctype:"Plot Detail",page:1,page_length:10,fields:o?null:JSON.stringify(V),filters:null}),{data:N,isFetching:K,refetch:$}=Oe(G),[C,J]=l.useState([]);l.useEffect(()=>{if(!o&&h){const m=[[n,"=",h]];n==="lead"?m.push(["lead_status","in",["New","Pending"]]):n==="customer"&&(m.push(["lead_status","!=","New"]),m.push(["lead_status","!=","Pending"]));const d=JSON.stringify(V),L=JSON.stringify(m);W(M=>M.filters===L&&M.fields===d?M:{...M,filters:L,fields:d})}},[h,n,o,V]),l.useEffect(()=>{o?J(f||[]):N!=null&&N.data?J(N.data):J([])},[o,f,N==null?void 0:N.data]);const Q=()=>{E(null),g(null),r(!0)},t=()=>{r(!1),E(null),g(null)},w=()=>{D(!1),E(null),g(null)},z=m=>{if(o&&c)if(x!==null){const d=[...f];d[x]={...m,lead_status:"New"},c(d)}else c([...f,{...m,lead_status:"New"}]);else $();t()},X=Re(m=>{m&&m.success&&(F(!1),v(null),$())}),ue=(m,d,L=null)=>{m.stopPropagation(),E(d),g(L),r(!0)},pe=(m,d)=>{m.stopPropagation(),E(d),D(!0)},He=(m,d,L=null)=>{m.stopPropagation(),v(d),j(L),F(!0)},Ze=(m,d)=>{m.stopPropagation();const L=["*Plot Details*","━━━━━━━━━━━━━━━━━━━━",`*Plot No:* ${d.plot_no||"N/A"}`,`*Plot ID:* ${d.plot_id||"N/A"}`,`*Project/Layout:* ${d.project_layout_name||"N/A"}`,`*Location:* ${d.location_village||"N/A"}`,`*Plot Size:* ${d.plot_size||"N/A"}`,`*Plot Type:* ${d.plot_type||"N/A"}`,`*Facing:* ${d.facing||"N/A"}`,`*Total Value:* ${d.total_plot_value?`AED ${parseFloat(d.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Rate per Sqft:* ${d.rate_per_sqft?`AED ${parseFloat(d.rate_per_sqft).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Booking Amount:* ${d.booking_amount?`AED ${parseFloat(d.booking_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Paid Amount:* ${d.paid_amount?`AED ${parseFloat(d.paid_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Balance Amount:* ${d.balance_amount?`AED ${parseFloat(d.balance_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Plot Status:* ${d.plot_status||"N/A"}`,`*Lead Status:* ${d.lead_status||"N/A"}`,d.remarks?`*Remarks:* ${d.remarks}`:""].filter(Boolean).join(`
`),Qe=`https://wa.me/?text=${encodeURIComponent(L)}`;window.open(Qe,"_blank")},Ge=()=>{if(o&&c&&U!==null){const m=f.filter((d,L)=>L!==U);c(m),F(!1),v(null),j(null)}else b&&X.mutate({doctype:"Plot Detail",ids:[b]})},Ke=()=>{F(!1),v(null)};return e.jsxs(te,{className:"p-4 sm:px-5",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-dark-50",children:"Plot Details"}),(n==="lead"||o)&&e.jsxs(y,{size:"sm",color:"primary",onClick:Q,className:"flex items-center gap-2",children:[e.jsx(xe,{className:"size-4"}),"Add Plot Detail"]})]}),!o&&!h?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading information..."}):!o&&K?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading plot details..."}):C.length===0?e.jsx("div",{className:"py-8 text-center text-sm text-gray-500 dark:text-dark-300",children:o?"No plot details added yet. Please add at least one plot detail before creating the lead.":`No plot details found ${n==="customer"?"for this customer":"for this lead"}.`}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-dark-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Project/Layout"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Lead Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-dark-200",children:[...C].reverse().map((m,d)=>{const L=C.length-1-d;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-dark-100 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_no||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.project_layout_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.location_village||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_size||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.total_plot_value?`AED ${parseFloat(m.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.lead_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!o&&e.jsx(y,{size:"sm",variant:"outlined",onClick:M=>pe(M,m.name),className:"p-1.5",children:e.jsx(xt,{className:"size-4"})}),e.jsx(y,{size:"sm",variant:"outlined",onClick:M=>Ze(M,m),className:"p-1.5",title:"Share on WhatsApp",children:e.jsx(qe,{className:"size-4"})}),(n==="lead"||o)&&e.jsx(y,{size:"sm",variant:"outlined",onClick:M=>ue(M,o?null:m.name,o?L:null),className:"p-1.5",children:e.jsx(Je,{className:"size-4"})}),e.jsx(y,{size:"sm",variant:"outlined",color:"error",onClick:M=>He(M,o?null:m.name,o?L:null),className:"p-1.5",disabled:!o&&X.isPending,children:e.jsx(_e,{className:"size-4"})})]})})]},o?L:m.name)})})]})}),e.jsx(ft,{isOpen:A,onClose:t,carProfileId:P,carProfileData:o&&x!==null?f[x]:null,customerId:s,customerName:a,leadId:i,leadName:u,isCreateMode:o,onSuccess:z}),e.jsx(yt,{isOpen:p,onClose:w,carProfileId:P}),e.jsx(Me,{show:k,onClose:Ke,onOk:Ge,confirmLoading:X.isPending,state:X.isError?"error":"pending",messages:{pending:{title:"Delete Plot Detail?",description:"Are you sure you want to delete this plot detail? This action cannot be undone.",actionText:"Delete"}}})]})}const fe="Lead",ne=["first_name","last_name","email_id","mobile_no","custom_address"],oe=["custom_next_follow_up_date","source","custom_followup_history","custom_assigned_user","custom_lead_status"],Ce={ignorFields:{status:!0,custom_followup_history:!0}};function Lt(){const a=typeof window<"u"&&window.localStorage&&(localStorage.getItem("salesPurchaseType")||"sales")==="sales"?"Customer":"Land Owner",{user:{username:i}}=at(),{isDark:u,darkColorScheme:o,lightColorScheme:f}=be(),c=st(),{id:n}=rt(),{data:h,isFetching:A}=Ne({doctype:fe,fields:JSON.stringify([...ne,...oe])}),{data:r,isFetching:p,refetch:D}=ve({doctype:fe,id:n,fields:JSON.stringify([...ne,...oe])}),[P,E]=l.useState([]),[x,g]=l.useState(!1),k=me(_=>{_&&(j(),c(-1))}),{register:F,handleSubmit:b,formState:{errors:v},control:U,reset:j,setValue:R}=Te({resolver:ze(Le(h==null?void 0:h.fields,["status"])),values:n?r:{},defaultValues:Object.fromEntries([...ne,...oe].map(_=>[_,""]))}),T=async _=>{if(n){const S={..._,custom_lead_type:a==="Customer"?"sales":"purchase"};k.mutate({doctype:fe,body:{...S,custom_lead_type:a==="Customer"?"sales":"purchase",id:n}})}else{g(!0);try{const S=await lt(_,P,i);if(!S||!S.lead_id&&!S.customer_id)throw new Error("Failed to create lead");j(),E([]),c(-1)}catch(S){console.error("Error creating lead:",S),Y(S)}finally{g(!1)}}};return A||p?e.jsx(je,{style:{"--sk-color":u?o[700]:f[300]}}):e.jsx(dt,{title:(n?"Edit ":"New ")+a,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ct,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[n?"Edit":"New"," ",a]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>c(-1),children:"Back"}),e.jsx(y,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",disabled:x,children:x?"Creating...":"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:b(T),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx(ht,{id:n,data:r,setValue:R,refetchData:D}),e.jsx(gt,{id:n,data:r,setValue:R,refetchData:D}),e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(ee,{infos:h,fields:ne,register:F,tables:Ce,control:U,errors:v})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-5 lg:space-y-6",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsx(ee,{infos:h,tables:Ce,fields:oe,register:F,control:U,errors:v,readOnlyFields:["custom_lead_status","custom_next_follow_up_date"]})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(kt,{leadId:n,customerId:r==null?void 0:r.customer,leadName:(r==null?void 0:r.lead_name)||(r==null?void 0:r.name),isCreateMode:!n,carProfilesToCreate:P,setCarProfilesToCreate:E})})]})]})})}export{Lt as default};
