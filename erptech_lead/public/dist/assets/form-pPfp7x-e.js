import{a as o,p as Y,j as e,C as K,B as d,q as ke,s as je,t as Z,v as g,w as be,x as h,k as w,J as G,I as E,U as B,A as ee,u as Ne,l as ve,y as _e,S as Ce}from"./index-CA5hYvF4.js";import{u as we,o as De}from"./index.esm-CfaYpkcJ.js";import{F as ae,S as T,a as se,b as Se,D as re}from"./dynamicForms-BWj5Mv9o.js";import{P as Fe}from"./Page-DRGXT54w.js";import{a as Ae,b as ce,c as de,d as Oe,u as Pe,e as Ee}from"./useApiHook-BFrwdBxT.js";import{F as Te,C as Me}from"./CarProfiles-Dl12Jr3F.js";import{C as ze}from"./ConfirmModal-DqhhJs29.js";import{F as $e,a as Je}from"./TrashIcon-qOgpfnZc.js";import{z as te,F as M}from"./transition-DepUEpKq.js";import{y as le,j as ne}from"./iconBase-BjazxlP7.js";import{F as Re}from"./DocumentPlusIcon-DSw2BGEv.js";import"./Datepicker-CsEuZ0ZS.js";import"./combobox-BBGGeSuq.js";import"./use-by-comparator-BwwcpCm_.js";import"./hidden-Ch8UUVwr.js";import"./active-element-history-Co1KpUKB.js";import"./calculate-active-index-BvHaOcpL.js";import"./use-tree-walker-CR9N67HP.js";import"./frozen-D9HBBuQ3.js";import"./label-CzOfrsQP.js";import"./useMutation-B9i3jLXB.js";import"./floating-ui.dom-CtcSe9Ld.js";function Ue({id:c,data:r,setValue:Q,refetchData:D,filterBy:t="lead",customerId:m=null}){const[R,n]=o.useState(!1),[U,y]=o.useState(!1),[S,k]=o.useState(null),[F,b]=o.useState(!1),[N,j]=o.useState(null),[v,L]=o.useState([]),[A,f]=o.useState([]),I=t==="customer"?"customer":"lead",x=t==="customer"&&(m||(r==null?void 0:r.name))||c,q=t==="customer"?m||(r==null?void 0:r.name)||c:(r==null?void 0:r.customer)||"",[s,i]=o.useState({lead:t==="lead"?c:(r==null?void 0:r.lead_name)||"",customer:q,car_profile:"",approval_manager:"",policy_name:"",policy_amount:"",status:"Waiting",type:"Addon",file_attachment:"",comments:""}),[me,xe]=o.useState({doctype:"COD Management",page:1,page_length:100,fields:JSON.stringify(["name","lead","customer","car_profile","approval_manager","policy_name","policy_amount","status","file_attachment","comments","creation","modified"]),filters:x?JSON.stringify([[I,"=",x],["type","!=","New"]]):null}),{data:_,isFetching:pe,refetch:V}=Ae(me);o.useEffect(()=>{if(x){const a=t==="customer"?[["customer","=",x],["status","=","New"]]:[["lead","=",x],["status","=","New"]];Y({doctype:"Car Profile",fields:JSON.stringify(["name","car_make","car_model","car_year"]),filters:JSON.stringify(a),page_length:100}).then(l=>{if(l!=null&&l.data){const C=l.data.map(u=>({label:`${u.car_make||""} ${u.car_model||""} ${u.car_year||""}`.trim()||u.name,value:u.name}));L(C)}}),Y({doctype:"User",fields:JSON.stringify(["name","full_name"]),filters:JSON.stringify([["role_profile_name","=","Lead User"]]),page_length:100}).then(l=>{if(l!=null&&l.data){const C=l.data.map(u=>({label:`${u.full_name||""}`.trim()||u.name,value:u.name}));f(C)}})}},[x,t]),o.useEffect(()=>{x&&xe(a=>({...a,filters:JSON.stringify([[I,"=",x],["type","!=","New"]])}))},[x,I]),o.useEffect(()=>{_!=null&&_.data?X(_.data):X([])},[_]);const[O,X]=o.useState([]),W=ce(a=>{a&&(n(!1),p(),V())}),H=de(a=>{a&&(y(!1),k(null),p(),V())}),P=Oe(a=>{a&&a.success&&(b(!1),j(null),V())}),p=()=>{i({lead:t==="lead"?c:(r==null?void 0:r.lead_name)||"",customer:q,car_profile:"",approval_manager:"",policy_name:"",policy_amount:"",status:"Waiting",type:"Addon",file_attachment:"",comments:""})},ue=()=>{if(s.file_attachment){const a={...s};t==="customer"&&!a.lead&&(r!=null&&r.lead)&&(a.lead=r.lead),W.mutate({doctype:"COD Management",body:a})}},ge=a=>{const l=O.find(C=>C.name===a);l&&(i({lead:l.lead||(t==="lead"?c:"")||"",customer:l.customer||q||"",car_profile:l.car_profile||"",approval_manager:l.approval_manager||"",policy_name:l.policy_name||"",policy_amount:l.policy_amount||"",status:l.status||"Waiting",type:"Addon",file_attachment:l.file_attachment||"",comments:l.comments||""}),k(a),y(!0))},he=()=>{S&&s.file_attachment&&H.mutate({doctype:"COD Management",body:{...s,id:S}})},fe=a=>{j(a),b(!0)},ye=()=>{N&&P.mutate({doctype:"COD Management",ids:[N]})};return o.useEffect(()=>{const a=t==="customer"?m||(r==null?void 0:r.name)||c:(r==null?void 0:r.customer)||"";a&&i(l=>({...l,customer:a}))},[r==null?void 0:r.customer,m,t,c,r==null?void 0:r.name]),x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(K,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"COD Document Approvals"}),e.jsxs(d,{onClick:()=>{p(),n(!0)},color:"primary",className:"flex items-center gap-2",children:[e.jsx(Te,{className:"size-4"}),"Approvals Request"]})]}),pe?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading COD documents..."}):O&&O.length>0?e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(ke,{hoverable:!0,className:"w-full min-w-[900px] text-left rtl:text-right",children:[e.jsx(je,{children:e.jsxs(Z,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Customer"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Car Profile"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Policy Name"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Policy Amount"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Status"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Approval Manager"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"File Attachment"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Comments"}),e.jsx(g,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Actions"})]})}),e.jsx(be,{children:O.map(a=>e.jsxs(Z,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:a.customer||"-"}),e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:a.car_profile||"-"}),e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:a.policy_name||"-"}),e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:a.policy_amount?`AED ${parseFloat(a.policy_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:e.jsx("span",{className:w("inline-flex rounded-full px-2 py-1 text-xs font-semibold",a.status==="Approve"&&"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",a.status==="Decline"&&"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",a.status==="Waiting"&&"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"),children:a.status||"-"})}),e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:a.approval_manager||"-"}),e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:a.file_attachment?e.jsx("a",{href:`${G}${a.file_attachment}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400",children:"View File"}):"-"}),e.jsx(h,{className:"text-gray-700 dark:text-dark-200",children:a.comments||"-"}),e.jsx(h,{children:a.status!=="Approve"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"sm",variant:"outlined",onClick:()=>ge(a.name),className:"p-1.5",children:e.jsx($e,{className:"size-4"})}),e.jsx(d,{size:"sm",variant:"outlined",color:"error",onClick:()=>fe(a.name),className:"p-1.5",disabled:P.isPending,children:e.jsx(Je,{className:"size-4"})})]})})]},a.name))})]})})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No COD documents yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(te,{appear:!0,show:R,as:le,onClose:()=>{n(!1),p()},children:[e.jsx(M,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(M,{as:ne,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Approvals Request"}),e.jsx("button",{onClick:()=>{n(!1),p()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(T,{label:"Car Profile",lists:v,value:s.car_profile,onChange:a=>i({...s,car_profile:a||""}),placeholder:"Select Car Profile",req:!0})}),e.jsx("div",{children:e.jsx(T,{label:"Approval Manager",lists:A,value:s.approval_manager,onChange:a=>i({...s,approval_manager:a||""}),placeholder:"Select Approval Manager",req:!0})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Policy Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(E,{value:s.policy_name,onChange:a=>i({...s,policy_name:a.target.value}),placeholder:"Enter Policy Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Policy Amount"}),e.jsx(E,{type:"number",value:s.policy_amount,onChange:a=>i({...s,policy_amount:a.target.value}),placeholder:"Enter Policy Amount",step:"0.01",min:"0"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["File Attachment ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{onChange:a=>{a&&i({...s,file_attachment:a})},children:({...a})=>e.jsxs(d,{...a,unstyled:!0,className:w("mt-3 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-10 border-gray-300 dark:border-dark-450"),children:[e.jsx(se,{className:"size-12"}),e.jsxs("span",{className:w("pointer-events-none mt-2 text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your files here"})]}),s.file_attachment&&e.jsx("span",{className:"mt-2 text-sm text-gray-500 dark:text-dark-300",children:"File selected"})]})}),s.file_attachment&&e.jsx("div",{className:"mt-2 flex flex-col space-y-4",children:e.jsx("div",{className:"relative inline-block",children:e.jsx(ee,{size:24,src:`${G}${s.file_attachment}`,classNames:{display:"rounded-lg"}})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:s.comments,onChange:a=>i({...s,comments:a.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(d,{variant:"outlined",onClick:()=>{n(!1),p()},children:"Cancel"}),e.jsx(d,{color:"primary",onClick:ue,disabled:!s.file_attachment||W.isPending,children:W.isPending?"Adding...":"Add Document"})]})]})})]}),e.jsxs(te,{appear:!0,show:U,as:le,onClose:()=>{y(!1),k(null),p()},children:[e.jsx(M,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(M,{as:ne,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Edit COD Document"}),e.jsx("button",{onClick:()=>{y(!1),k(null),p()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(T,{label:"Car Profile",lists:v,value:s.car_profile,onChange:a=>i({...s,car_profile:a||""}),placeholder:"Select Car Profile"})}),e.jsx("div",{children:e.jsx(T,{label:"Approval Manager",lists:A,value:s.approval_manager,onChange:a=>i({...s,approval_manager:a||""}),placeholder:"Select Approval Manager"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Policy Name"}),e.jsx(E,{value:s.policy_name,onChange:a=>i({...s,policy_name:a.target.value}),placeholder:"Enter Policy Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Policy Amount"}),e.jsx(E,{type:"number",value:s.policy_amount,onChange:a=>i({...s,policy_amount:a.target.value}),placeholder:"Enter Policy Amount",step:"0.01",min:"0"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["File Attachment ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{onChange:a=>{a&&i({...s,file_attachment:a})},children:({...a})=>e.jsxs(d,{...a,unstyled:!0,className:w("mt-3 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-10 border-gray-300 dark:border-dark-450"),children:[e.jsx(se,{className:"size-12"}),e.jsxs("span",{className:w("pointer-events-none mt-2 text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your files here"})]}),s.file_attachment&&e.jsx("span",{className:"mt-2 text-sm text-gray-500 dark:text-dark-300",children:"File selected"})]})}),s.file_attachment&&e.jsx("div",{className:"mt-2 flex flex-col space-y-4",children:e.jsx("div",{className:"relative inline-block",children:e.jsx(ee,{size:24,src:`${G}${s.file_attachment}`,classNames:{display:"rounded-lg"}})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:s.comments,onChange:a=>i({...s,comments:a.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(d,{variant:"outlined",onClick:()=>{y(!1),k(null),p()},children:"Cancel"}),e.jsx(d,{color:"primary",onClick:he,disabled:!s.file_attachment||H.isPending,children:H.isPending?"Updating...":"Update Document"})]})]})})]}),e.jsx(ze,{show:F,onClose:()=>{b(!1),j(null)},onOk:ye,confirmLoading:P.isPending,state:P.isError?"error":"pending",messages:{pending:{title:"Delete COD Document?",description:"Are you sure you want to delete this COD document? This action cannot be undone.",actionText:"Delete"}}})]}):null}const ie="Customer List",z="Customer",$=["customer_name","customer_type"],J=["customer_primary_address","custom_customer_image"],oe={customer_site_addresses:{title:!0,address:!0},ignorFields:{}},Le=Object.fromEntries([...$,...J].map(c=>[c,""]));function da(){const{isDark:c,darkColorScheme:r,lightColorScheme:Q}=Ne(),D=ve(),{id:t}=_e(),{data:m,isFetching:R}=Pe({doctype:z,fields:JSON.stringify([...$,...J])}),{data:n,isFetching:U,refetch:y}=Ee({doctype:z,id:t,fields:JSON.stringify([...$,...J])}),S=ce(f=>{f&&(v(),D(-1))}),k=de(f=>{f&&(v(),D(-1))}),{register:F,handleSubmit:b,formState:{errors:N},control:j,reset:v,setValue:L}=we({resolver:De(Se(m==null?void 0:m.fields)),values:t?n:Le}),A=f=>{t?k.mutate({doctype:z,body:{...f,id:t}}):S.mutate({doctype:z,body:f})};return R||U?e.jsx(Ce,{style:{"--sk-color":c?r[700]:Q[300]}}):e.jsx(Fe,{title:(t?"Edit ":"New ")+ie,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Re,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[t?"Edit":"New"," ",ie]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>D(-1),children:"Back"}),e.jsx(d,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",children:"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:b(A),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[t&&e.jsx(Ue,{id:n==null?void 0:n.lead,data:n,setValue:L,refetchData:y,filterBy:"customer",customerId:t}),e.jsx("div",{className:"col-span-12 lg:col-span-8",children:e.jsx(K,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(re,{infos:m,fields:$,register:F,tables:oe,control:j,errors:N})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-4 lg:space-y-6",children:e.jsx(K,{className:"p-4 sm:px-5",children:e.jsx(re,{infos:m,tables:oe,fields:J,register:F,control:j,errors:N})})})]}),t&&e.jsx("div",{className:"mt-6",children:e.jsx(Me,{customerId:t,leadId:n==null?void 0:n.lead,customerName:(n==null?void 0:n.customer_name)||(n==null?void 0:n.name)})})]})]})})}export{da as default};
