import{a as n,u as ce,y as I,j as e,S as de,B as V,C as ye,q as je,s as ke,t as se,v as E,w as be,x as D}from"./index-CtyxRQH4.js";import{u as me,b as ue,c as ve,d as _e,a as we,e as Ne}from"./useApiHook-CSVdL_yw.js";import{u as Fe,o as Se,a as Ee}from"./index.esm-2_PVM501.js";import{S as De,F as xe,D as re}from"./dynamicForms-DwDa1hz7.js";import{z as Q,F as T}from"./transition-BL_LW8qL.js";import{y as X,j as M}from"./iconBase-S9e1lt1i.js";import{C as Pe}from"./ConfirmModal-DUZVYQ2_.js";import{F as Te,a as ze}from"./TrashIcon-C46bdLOR.js";function Ce({title:a,titleId:l,...r},m){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":l},r),a?n.createElement("title",{id:l},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Je=n.forwardRef(Ce);function Le({title:a,titleId:l,...r},m){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":l},r),a?n.createElement("title",{id:l},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Ve=n.forwardRef(Le),Y="Car Profile",G=["car_make","car_model","car_year","car_brand_new","car_emirate","car_registration_date"],K=["date_of_birth","nationality","license_country","driving_experience","policy_start_date","current_policy_active","claims_last_12_months","no_claims_years","gcc_specification","personal_use_only","policy_fully_comprehensive"],ne={ignorFields:{}},ee=Object.fromEntries([...G,...K].map(a=>[a,""]));function Re({isOpen:a,onClose:l,carProfileId:r,carProfileData:m=null,customerId:s,customerName:j,leadId:h,leadName:c,isCreateMode:o=!1,onSuccess:k}){const{isDark:P,darkColorScheme:y,lightColorScheme:O}=ce(),{data:p,isFetching:z}=me({doctype:Y,fields:JSON.stringify([...G,...K])}),[C,u]=n.useState([]),J=n.useMemo(()=>p&&{...p,fields:p.fields.map(i=>i.fieldname==="car_model"?{...i,options_list:C}:i)},[p,C]),{data:b,isFetching:U,refetch:L}=ue({doctype:Y,id:a&&r&&!o?r:null,fields:JSON.stringify([...G,...K])});n.useEffect(()=>{a&&r&&!o&&L()},[a,r,o,L]);const v=ve(()=>{N(),k&&k(),l()}),_=_e(()=>{N(),k&&k(),l()}),{register:R,handleSubmit:W,formState:{errors:Z,isSubmitting:w},control:A,reset:N,setValue:F}=Fe({resolver:Se(De((J==null?void 0:J.fields)||(p==null?void 0:p.fields))),defaultValues:ee,mode:"onChange"}),S=Ee({control:A,name:"car_make"}),$=n.useRef(S);n.useEffect(()=>{S?($.current&&$.current!==S&&F("car_model",""),I({doctype:"Model",fields:JSON.stringify(["name","title","make"]),filters:JSON.stringify([["make","=",S]])}).then(i=>{if(i!=null&&i.data){const d=i.data.map(x=>({label:x.title||x.name,value:x.name}));u(d)}else u([])}).catch(()=>{u([])})):(u([]),F("car_model","")),$.current=S},[S,F]),n.useEffect(()=>{a?o&&m?(N(m),m.car_make?I({doctype:"Model",fields:JSON.stringify(["name","title","make"]),filters:JSON.stringify([["make","=",m.car_make]])}).then(i=>{if(i!=null&&i.data){const d=i.data.map(x=>({label:x.title||x.name,value:x.name}));u(d)}}).catch(()=>{u([])}):u([])):r&&!o?b&&(N(b),b.car_make&&I({doctype:"Model",fields:JSON.stringify(["name","title","make"]),filters:JSON.stringify([["make","=",b.car_make]])}).then(i=>{if(i!=null&&i.data){const d=i.data.map(x=>({label:x.title||x.name,value:x.name}));u(d)}}).catch(()=>{u([])})):(N(ee),u([]),o||(s&&F("customer",s),h?F("lead",h):c&&F("lead",c))):(N(ee),u([]))},[a,r,m,o,b,s,j,h,c,N,F]);const B=i=>{if(console.log("Form submitted with data:",i),o){const x={...i};(h||c)&&(x.status="New"),k&&k(x);return}const d={...i};d.lead=h,d.customer=s,console.log("Submitting with data:",d),r?(console.log("Calling mutationUpdate..."),_.mutate({doctype:Y,body:{...d,id:r}})):(d.status="New",console.log("Calling mutationAdd..."),v.mutate({doctype:Y,body:d}))},q=i=>{console.log("Form validation errors:",i)};return z||a&&r&&!o&&U?e.jsx(Q,{show:a,children:e.jsxs(X,{open:a,onClose:l,static:!1,autoFocus:!0,children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!v.isPending&&!_.isPending&&l()}}),e.jsx(T,{as:M,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[r?"Edit":"New"," Car Profile"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsx(de,{style:{"--sk-color":P?y[700]:O[300]}})})]})})]})}):e.jsx(Q,{show:a,children:e.jsxs(X,{open:a,onClose:i=>{!v.isPending&&!_.isPending&&l()},static:v.isPending||_.isPending,autoFocus:!0,children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!v.isPending&&!_.isPending&&l()}}),e.jsxs(T,{as:M,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[r?"Edit":"New"," Car Profile"]}),e.jsx("button",{onClick:l,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(xe,{className:"size-5"})})]}),e.jsxs("form",{onSubmit:W(B,q),className:"flex min-h-0 flex-1 flex-col overflow-hidden",noValidate:!0,children:[e.jsx("div",{className:"scrollbar-sm flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 p-5 sm:gap-5 lg:gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-6",children:e.jsx(re,{infos:J||p,fields:G,register:R,tables:ne,control:A,errors:Z})}),e.jsx("div",{className:"col-span-12 lg:col-span-6",children:e.jsx(re,{infos:J||p,tables:ne,fields:K,register:R,control:A,errors:Z})})]})}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(V,{variant:"outlined",onClick:l,children:"Cancel"}),e.jsx(V,{color:"primary",type:"button",onClick:W(B,q),disabled:w||v.isPending||_.isPending,children:w||v.isPending||_.isPending?"Saving...":r?"Update":"Create"})]})]})]})]})})}const le="Car Profile",ae=["status","car_make","car_model","car_year","car_brand_new","car_emirate","car_registration_date"],te=["date_of_birth","nationality","license_country","driving_experience","policy_start_date","current_policy_active","claims_last_12_months","no_claims_years","gcc_specification","personal_use_only","policy_fully_comprehensive"],ie=(a,l)=>{var m;const r=(m=a==null?void 0:a.fields)==null?void 0:m.find(s=>s.fieldname===l);return(r==null?void 0:r.label)||l},oe=a=>a==null||a===""?"-":a;function Ae({isOpen:a,onClose:l,carProfileId:r}){const{isDark:m,darkColorScheme:s,lightColorScheme:j}=ce(),{data:h,isFetching:c}=me({doctype:le,fields:JSON.stringify([...ae,...te])}),{data:o,isFetching:k,refetch:P}=ue({doctype:le,id:a&&r?r:null,fields:JSON.stringify([...ae,...te])});return n.useEffect(()=>{a&&r&&P()},[a,r,P]),c||a&&r&&k?e.jsx(Q,{show:a,children:e.jsxs(X,{open:a,onClose:l,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:l}),e.jsxs(T,{as:M,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl dark:bg-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 pb-4 dark:border-dark-500",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"})}),e.jsx("div",{className:"mt-4",children:e.jsx(de,{style:{"--sk-color":m?s[700]:j[300]}})})]})]})}):o?e.jsx(Q,{show:a,children:e.jsxs(X,{open:a,onClose:l,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(T,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:l}),e.jsxs(T,{as:M,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"scrollbar-sm relative flex max-h-[90vh] w-full max-w-4xl flex-col overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-dark-700",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"}),e.jsx("button",{onClick:l,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(xe,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Car Information"}),e.jsx("div",{className:"space-y-3",children:ae.map(y=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:ie(h,y)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:oe(o[y])})]},y))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Additional Information"}),e.jsx("div",{className:"space-y-3",children:te.map(y=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:ie(h,y)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:oe(o[y])})]},y))})]})]})}),e.jsx("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 dark:border-dark-500",children:e.jsx(V,{color:"primary",onClick:l,children:"Close"})})]})]})}):null}function Ye({customerId:a,customerName:l,leadId:r,leadName:m,isCreateMode:s=!1,carProfilesToCreate:j=[],setCarProfilesToCreate:h=null}){const c=l?"customer":"lead",o=c==="customer"?a:r,[k,P]=n.useState(!1),[y,O]=n.useState(!1),[p,z]=n.useState(null),[C,u]=n.useState(null),[J,b]=n.useState(!1),[U,L]=n.useState(null),[v,_]=n.useState(null),R=n.useMemo(()=>c==="customer"?["name","car_year","car_make","car_model","car_brand_new","car_emirate","policy_start_date","car_registration_date","status"]:["name","car_year","car_make","car_model","car_brand_new","car_emirate","policy_start_date","car_registration_date","status"],[c]),[W,Z]=n.useState({doctype:"Car Profile",page:1,page_length:10,fields:s?null:JSON.stringify(R),filters:null}),{data:w,isFetching:A,refetch:N}=we(W),[F,S]=n.useState([]);n.useEffect(()=>{if(!s&&o){const t=[[c,"=",o]];c==="lead"?t.push(["status","in",["New","Cod Pending"]]):c==="customer"&&(t.push(["status","!=","New"]),t.push(["status","!=","Cod Pending"]));const f=JSON.stringify(R),g=JSON.stringify(t);Z(H=>H.filters===g&&H.fields===f?H:{...H,filters:g,fields:f})}},[o,c,s,R]),n.useEffect(()=>{s?S(j||[]):w!=null&&w.data?S(w.data):S([])},[s,j,w==null?void 0:w.data]);const $=()=>{z(null),u(null),P(!0)},B=()=>{P(!1),z(null),u(null)},q=()=>{O(!1),z(null),u(null)},i=t=>{if(s&&h)if(C!==null){const f=[...j];f[C]=t,h(f)}else h([...j,t]);else N();B()},d=Ne(t=>{t&&t.success&&(b(!1),L(null),N())}),x=(t,f,g=null)=>{t.stopPropagation(),z(f),u(g),P(!0)},fe=(t,f)=>{t.stopPropagation(),z(f),O(!0)},he=(t,f,g=null)=>{t.stopPropagation(),L(f),_(g),b(!0)},ge=()=>{if(s&&h&&v!==null){const t=j.filter((f,g)=>g!==v);h(t),b(!1),L(null),_(null)}else U&&d.mutate({doctype:"Car Profile",ids:[U]})},pe=()=>{b(!1),L(null)};return e.jsxs(ye,{className:"p-4 sm:px-5",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-dark-50",children:"Car Profiles"}),(c==="lead"||s)&&e.jsxs(V,{size:"sm",color:"primary",onClick:$,className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"size-4"}),"Add Car Profile"]})]}),!s&&!o?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading information..."}):!s&&A?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading car profiles..."}):F.length===0?e.jsx("div",{className:"py-8 text-center text-sm text-gray-500 dark:text-dark-300",children:s?"No car profiles added yet. Please add at least one car profile before creating the lead.":`No car profiles found ${c==="customer"?"for this customer":"for this lead"}.`}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(je,{children:[e.jsx(ke,{children:e.jsxs(se,{children:[e.jsx(E,{children:"Year"}),e.jsx(E,{children:"Make"}),e.jsx(E,{children:"Model"}),e.jsx(E,{children:"Brand New"}),e.jsx(E,{children:"Emirate"}),e.jsx(E,{children:"Policy Start Date"}),e.jsx(E,{children:"Registration Date"}),e.jsx(E,{children:"Status"}),e.jsx(E,{children:"Actions"})]})}),e.jsx(be,{children:F.map((t,f)=>e.jsxs(se,{className:"hover:bg-gray-50 dark:hover:bg-dark-700",children:[e.jsx(D,{children:t.car_year||"-"}),e.jsx(D,{children:t.car_make||"-"}),e.jsx(D,{children:t.car_model||"-"}),e.jsx(D,{children:t.car_brand_new||"-"}),e.jsx(D,{children:t.car_emirate||"-"}),e.jsx(D,{children:t.policy_start_date||"-"}),e.jsx(D,{children:t.car_registration_date||"-"}),e.jsx(D,{children:t.status||"-"}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[!s&&e.jsx(V,{size:"sm",variant:"outlined",onClick:g=>fe(g,t.name),className:"p-1.5",children:e.jsx(Je,{className:"size-4"})}),(c==="lead"||s)&&e.jsx(V,{size:"sm",variant:"outlined",onClick:g=>x(g,s?null:t.name,s?f:null),className:"p-1.5",children:e.jsx(Te,{className:"size-4"})}),e.jsx(V,{size:"sm",variant:"outlined",color:"error",onClick:g=>he(g,s?null:t.name,s?f:null),className:"p-1.5",disabled:!s&&d.isPending,children:e.jsx(ze,{className:"size-4"})})]})})]},s?f:t.name))})]})}),e.jsx(Re,{isOpen:k,onClose:B,carProfileId:p,carProfileData:s&&C!==null?j[C]:null,customerId:a,customerName:l,leadId:r,leadName:m,isCreateMode:s,onSuccess:i}),e.jsx(Ae,{isOpen:y,onClose:q,carProfileId:p}),e.jsx(Pe,{show:J,onClose:pe,onOk:ge,confirmLoading:d.isPending,state:d.isError?"error":"pending",messages:{pending:{title:"Delete Car Profile?",description:"Are you sure you want to delete this car profile? This action cannot be undone.",actionText:"Delete"}}})]})}export{Ye as C,Ve as F};
