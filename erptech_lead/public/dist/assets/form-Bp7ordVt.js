import{a as l,j as e,C as te,B as y,k as $e,l as Pe,n as ce,o as B,p as Ee,q as I,s as we,t as ie,v as Xe,w as Y,x as Ye,u as be,S as je,I as et,U as tt,J as ye,e as at,y as st,z as rt,D as lt}from"./index-RYOzBd11.js";import{u as Te,o as ze,a as nt,C as ot}from"./index.esm-D7Is-Opz.js";import{F as ae,S as se,a as Le,D as ee,b as it}from"./dynamicForms-4JduQl6I.js";import{P as dt}from"./Page-B-KNyqFp.js";import{b as me,y as H,j as Z,a as Oe,c as Ue,d as Re,C as Me,u as Ne,e as ve}from"./ConfirmModal-fuf52CCC.js";import{F as xe}from"./PlusIcon-CtQz4fur.js";import{z as G,F as U}from"./transition-Dha4MsGh.js";import{F as Je}from"./PencilIcon-3IwpOs41.js";import{F as _e}from"./TrashIcon-BrzQfV3W.js";import{F as ct}from"./DocumentPlusIcon-BC1O2cLO.js";import"./iconBase-ZBJTecpS.js";import"./use-event-listener-e5zyxHSA.js";import"./Datepicker-cIpb0coF.js";import"./combobox-B5WFY3Yb.js";import"./use-by-comparator-D8LSY6cJ.js";import"./calculate-active-index-Dpt8YwVl.js";import"./useMutation-Dpcm0OUf.js";import"./floating-ui.dom-CtcSe9Ld.js";function mt({title:r,titleId:a,...d},u){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":a},d),r?l.createElement("title",{id:a},r):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const xt=l.forwardRef(mt);function ut({title:r,titleId:a,...d},u){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":a},d),r?l.createElement("title",{id:a},r):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"}))}const qe=l.forwardRef(ut);function pt({id:r,data:a,setValue:d,refetchData:u}){var s;const[o,f]=l.useState(!1),[c,n]=l.useState({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]}),h=me(p=>{p&&o&&(f(!1),u())}),S=()=>{if(c.description&&c.description.trim()&&c.next_date){const p=(a==null?void 0:a.custom_followup_history)||[],D=[...p,{...c,idx:p.length+1}];h.mutate({doctype:"Lead",body:{id:r,custom_followup_history:D,custom_next_follow_up_date:c.next_date,custom_lead_status:"Call Back"}}),d("custom_followup_history",D),n({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})}};return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Follow-up History Records"}),e.jsxs(y,{onClick:()=>f(!0),color:"primary",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"size-4"}),"Add New Record"]})]}),a!=null&&a.custom_followup_history&&((s=a==null?void 0:a.custom_followup_history)==null?void 0:s.length)>0?e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs($e,{hoverable:!0,className:"w-full min-w-[600px] text-left rtl:text-right",children:[e.jsx(Pe,{children:e.jsxs(ce,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"#"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Created Date"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Description"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Next Follow-up Date"})]})}),e.jsx(Ee,{children:a==null?void 0:a.custom_followup_history.map((p,D)=>e.jsxs(ce,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:D+1}),e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:p.created_date?new Date(p.created_date).toLocaleDateString():"-"}),e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:p.description||"-"}),e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:p.next_date?new Date(p.next_date).toLocaleDateString():"-"})]},D))})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No follow-up records yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(G,{appear:!0,show:o,as:H,onClose:()=>f(!1),children:[e.jsx(U,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(U,{as:Z,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-lg flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Follow-up History"}),e.jsx("button",{onClick:()=>f(!1),className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:c.description,onChange:p=>n({...c,description:p.target.value}),placeholder:"Enter follow-up description...",rows:"4",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Created Date"}),e.jsx("input",{type:"date",value:c.created_date,onChange:p=>n({...c,created_date:p.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Next Follow-up Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:c.next_date,onChange:p=>n({...c,next_date:p.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:()=>{f(!1),n({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})},children:"Cancel"}),e.jsx(y,{color:"primary",onClick:S,disabled:!c.description||!c.description.trim()||!c.next_date,children:"Add Record"})]})]})})]})]}):null}function gt({id:r,data:a}){const[d,u]=l.useState(!1),[o,f]=l.useState(!1),[c,n]=l.useState(null),[h,S]=l.useState(!1),[s,p]=l.useState(null),[D,C]=l.useState([]),[P,x]=l.useState([]),[g,k]=l.useState({lead:r||"",customer:(a==null?void 0:a.customer)||"",plot_detail:"",approval_manager:"",status:"Waiting",comments:""}),[F,b]=l.useState({doctype:"Management",page:1,page_length:100,fields:JSON.stringify(["name","lead","customer","plot_detail","approval_manager","status","comments","creation","modified"]),filters:r?JSON.stringify([["lead","=",r],["status","=","Waiting"]]):null}),{data:v,isFetching:R,refetch:j}=Oe(F);l.useEffect(()=>{r&&(we({doctype:"Plot Detail",fields:JSON.stringify(["name","plot_no","plot_id","project_layout_name","location_village"]),filters:JSON.stringify([["lead","=",r],["lead_status","=","New"]]),page_length:100}).then(t=>{if(t!=null&&t.data){const w=t.data.map(L=>({label:`${L.plot_no||""}`.trim()||L.plot_id||L.name,value:L.name}));C(w)}}),we({doctype:"User",fields:JSON.stringify(["name","full_name"]),filters:JSON.stringify([["role_profile_name","=","Lead Manager"]]),page_length:100}).then(t=>{if(t!=null&&t.data){const w=t.data.map(L=>({label:`${L.full_name||""}`.trim()||L.name,value:L.name}));x(w)}}))},[r]),l.useEffect(()=>{r&&b(t=>({...t,filters:JSON.stringify([["lead","=",r],["status","=","Waiting"]])}))},[r]),l.useEffect(()=>{v!=null&&v.data?z(v.data):z([])},[v]);const[M,z]=l.useState([]),[E,_]=l.useState(!1),[T,V]=l.useState(!1);Ue(t=>{t&&(u(!1),N(),j())}),me(t=>{t&&(f(!1),n(null),N(),j())});const W=Re(t=>{t&&t.success&&(S(!1),p(null),j())}),N=()=>{k({lead:r||"",customer:(a==null?void 0:a.customer)||"",plot_detail:"",approval_manager:"",status:"Waiting",type:"New",comments:""})},K=async()=>{_(!0);try{const t=await Xe(g);t&&t.cod_id?(u(!1),N(),j()):Y({message:"Failed to create Management"})}catch(t){console.error("Error creating Management:",t),Y(t)}finally{_(!1)}},$=t=>{const w=M.find(L=>L.name===t);w&&(k({lead:w.lead||r||"",customer:w.customer||(a==null?void 0:a.customer)||"",plot_detail:w.plot_detail||"",approval_manager:w.approval_manager||"",status:w.status||"Waiting",comments:w.comments||""}),n(t),f(!0))},A=async()=>{if(!c){Y({message:"Management ID is required"});return}V(!0);try{const t=await Ye(c,g);t&&t.cod_id?(f(!1),n(null),N(),j()):Y({message:"Failed to update Management"})}catch(t){console.error("Error updating Management:",t),Y(t)}finally{V(!1)}},q=t=>{p(t),S(!0)},Q=()=>{s&&W.mutate({doctype:"Management",ids:[s]})};return l.useEffect(()=>{a!=null&&a.customer&&k(t=>({...t,customer:a.customer}))},[a==null?void 0:a.customer]),r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Document Approvals"}),e.jsxs(y,{onClick:()=>{N(),u(!0)},color:"primary",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"size-4"}),"Approvals Request"]})]}),R?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading documents..."}):M&&M.length>0?e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs($e,{hoverable:!0,className:"w-full min-w-[900px] text-left rtl:text-right",children:[e.jsx(Pe,{children:e.jsxs(ce,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Customer"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Plot Detail"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Status"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Approval Manager"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Comments"}),e.jsx(B,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Actions"})]})}),e.jsx(Ee,{children:M.map(t=>e.jsxs(ce,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:t.customer||"-"}),e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:t.plot_detail||"-"}),e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:e.jsx("span",{className:ie("inline-flex rounded-full px-2 py-1 text-xs font-semibold",t.status==="Approve"&&"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",t.status==="Decline"&&"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",t.status==="Waiting"&&"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"),children:t.status||"-"})}),e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:t.approval_manager||"-"}),e.jsx(I,{className:"text-gray-700 dark:text-dark-200",children:t.comments||"-"}),e.jsx(I,{children:t.status!=="Approve"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{size:"sm",variant:"outlined",onClick:()=>$(t.name),className:"p-1.5",children:e.jsx(Je,{className:"size-4"})}),e.jsx(y,{size:"sm",variant:"outlined",color:"error",onClick:()=>q(t.name),className:"p-1.5",disabled:W.isPending,children:e.jsx(_e,{className:"size-4"})})]})})]},t.name))})]})})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No documents yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(G,{appear:!0,show:d,as:H,onClose:()=>{u(!1),N()},children:[e.jsx(U,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(U,{as:Z,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Approvals Request"}),e.jsx("button",{onClick:()=>{u(!1),N()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(se,{label:"Plot Detail",lists:D,value:g.plot_detail,onChange:t=>k({...g,plot_detail:t||""}),placeholder:"Select Plot Detail",req:!0})}),e.jsx("div",{children:e.jsx(se,{label:"Approval Manager",lists:P,value:g.approval_manager,onChange:t=>k({...g,approval_manager:t||""}),placeholder:"Select Approval Manager",req:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:g.comments,onChange:t=>k({...g,comments:t.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:()=>{u(!1),N()},children:"Cancel"}),e.jsx(y,{color:"primary",onClick:K,disabled:E,children:E?"Adding...":"Add Document"})]})]})})]}),e.jsxs(G,{appear:!0,show:o,as:H,onClose:()=>{f(!1),n(null),N()},children:[e.jsx(U,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(U,{as:Z,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Edit Document"}),e.jsx("button",{onClick:()=>{f(!1),n(null),N()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(se,{label:"Plot Detail",lists:D,value:g.plot_detail,onChange:t=>k({...g,plot_detail:t||""}),placeholder:"Select Plot Detail"})}),e.jsx("div",{children:e.jsx(se,{label:"Approval Manager",lists:P,value:g.approval_manager,onChange:t=>k({...g,approval_manager:t||""}),placeholder:"Select Approval Manager"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:g.comments,onChange:t=>k({...g,comments:t.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:()=>{f(!1),n(null),N()},children:"Cancel"}),e.jsx(y,{color:"primary",onClick:A,disabled:T,children:T?"Updating...":"Update Document"})]})]})})]}),e.jsx(Me,{show:h,onClose:()=>{S(!1),p(null)},onOk:Q,confirmLoading:W.isPending,state:W.isError?"error":"pending",messages:{pending:{title:"Delete Management Document?",description:"Are you sure you want to delete this management document? This action cannot be undone.",actionText:"Delete"}}})]}):null}const re="Plot Detail",Ve=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],Be=["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],Ie=["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],We=["plot_status","booking_date","sale_date","handover_date","remarks"],ke=[...Ve,...Be,...Ie,...We],le={ignorFields:{all_document:!0}},de=Object.fromEntries(ke.map(r=>[r,""]));de.all_document=[];function ht({isOpen:r,onClose:a,carProfileId:d,carProfileData:u=null,customerId:o,customerName:f,leadId:c,leadName:n,isCreateMode:h=!1,onSuccess:S}){const{isDark:s,darkColorScheme:p,lightColorScheme:D}=be(),{data:C,isFetching:P}=Ne({doctype:re,fields:JSON.stringify(ke)}),{data:x,isFetching:g,refetch:k}=ve({doctype:re,id:r&&d&&!h?d:null,fields:JSON.stringify(ke)});l.useEffect(()=>{r&&d&&!h&&k()},[r,d,h,k]);const F=Ue(()=>{E(),S&&S(),a()}),b=me(()=>{E(),S&&S(),a()}),{register:v,handleSubmit:R,formState:{errors:j,isSubmitting:M},control:z,reset:E,setValue:_}=Te({resolver:ze(Le(C==null?void 0:C.fields)),defaultValues:de,mode:"onChange"}),{fields:T,append:V,remove:W}=nt({control:z,name:"all_document"});l.useEffect(()=>{if(r)if(h&&u){const $={...u,all_document:Array.isArray(u.all_document)?u.all_document:[]};E($)}else if(d&&!h){if(x){const $={...x,all_document:Array.isArray(x.all_document)?x.all_document:[]};E($)}}else E(de),h||(o&&_("customer",o),c?_("lead",c):n&&_("lead",n));else E(de)},[r,d,u,h,x,o,f,c,n,E,_]);const N=$=>{if(console.log("Form submitted with data:",$),h){const q={...$};(c||n)&&(q.status="New"),S&&S(q);return}const A={...$};A.lead=c,A.customer=o,console.log("Submitting with data:",A),d?(console.log("Calling mutationUpdate..."),b.mutate({doctype:re,body:{...A,id:d}})):(A.status="New",console.log("Calling mutationAdd..."),F.mutate({doctype:re,body:A}))},K=$=>{console.log("Form validation errors:",$)};return P||r&&d&&!h&&g?e.jsx(G,{show:r,children:e.jsxs(H,{open:r,onClose:a,static:!1,autoFocus:!0,children:[e.jsx(U,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!F.isPending&&!b.isPending&&a()}}),e.jsx(U,{as:Z,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[d?"Edit":"New"," Plot Detail"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsx(je,{style:{"--sk-color":s?p[700]:D[300]}})})]})})]})}):e.jsx(G,{show:r,children:e.jsxs(H,{open:r,onClose:$=>{!F.isPending&&!b.isPending&&a()},static:F.isPending||b.isPending,autoFocus:!0,children:[e.jsx(U,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!F.isPending&&!b.isPending&&a()}}),e.jsxs(U,{as:Z,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[d?"Edit":"New"," Plot Detail"]}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsxs("form",{onSubmit:R(N,K),className:"flex min-h-0 flex-1 flex-col overflow-hidden",noValidate:!0,children:[e.jsxs("div",{className:"scrollbar-sm flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-5 sm:gap-5 lg:gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Basic Plot Details"}),e.jsx(ee,{infos:C,fields:Ve,register:v,tables:le,control:z,errors:j})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Ownership & Legal"}),e.jsx(ee,{infos:C,fields:Be,register:v,tables:le,control:z,errors:j})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Financial Details"}),e.jsx(ee,{infos:C,fields:Ie,register:v,tables:le,control:z,errors:j})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Status Tracking"}),e.jsx(ee,{infos:C,fields:We,register:v,tables:le,control:z,errors:j})]})]})]}),e.jsxs("div",{className:"px-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b pb-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-dark-100",children:"All Documents"}),e.jsxs(y,{type:"button",variant:"flat",size:"sm",onClick:()=>V({title:"",file:""}),className:"gap-1",children:[e.jsx(xe,{className:"size-4"}),"Add Document"]})]}),e.jsxs("div",{className:"space-y-4",children:[T.map(($,A)=>{var q,Q,t;return e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4 dark:border-dark-500",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-dark-300",children:["Document ",A+1]}),e.jsxs(y,{type:"button",variant:"flat",size:"sm",color:"error",onClick:()=>W(A),className:"gap-1",children:[e.jsx(_e,{className:"size-4"}),"Remove"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{label:"Title",placeholder:"Enter document title",...v(`all_document.${A}.title`),error:(t=(Q=(q=j==null?void 0:j.all_document)==null?void 0:q[A])==null?void 0:Q.title)==null?void 0:t.message}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-200",children:"File"}),e.jsx(ot,{name:`all_document.${A}.file`,control:z,render:({field:{value:w,onChange:L}})=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:ie("flex-1",w&&"max-w-[60%]"),children:e.jsx(tt,{onChange:L,accept:"image/*",children:({onClick:X,disabled:ue,...pe})=>e.jsxs(y,{...pe,type:"button",unstyled:!0,onClick:X,disabled:ue,className:ie("mt-1 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-6 border-gray-300 dark:border-dark-450","hover:border-primary-400 dark:hover:border-primary-500"),children:[e.jsx(it,{className:"size-8 text-gray-400 dark:text-dark-400"}),e.jsxs("span",{className:ie("pointer-events-none mt-2 text-sm text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your file here"})]}),w&&e.jsx("span",{className:"mt-2 text-xs text-gray-500 dark:text-dark-300",children:"File selected"})]})})}),w&&e.jsx("div",{className:"mt-1 flex-shrink-0",children:e.jsx("img",{src:w.startsWith("http")?w:`${ye}${w}`,alt:"Preview",className:"h-32 w-32 rounded border border-gray-200 object-cover dark:border-dark-500"})})]})})]})]})]},$.id)}),T.length===0&&e.jsx("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center dark:border-dark-500",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:'No documents added. Click "Add Document" to add one.'})})]})]})]}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(y,{variant:"outlined",onClick:a,children:"Cancel"}),e.jsx(y,{color:"primary",type:"button",onClick:R(N,K),disabled:M||F.isPending||b.isPending,children:M||F.isPending||b.isPending?"Saving...":d?"Update":"Create"})]})]})]})]})})}const De="Plot Detail",ge=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],he=["status","owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status","rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","buyer_name","contact_number","email_id","address","agent_reference_name","plot_status","booking_date","sale_date","handover_date","remarks"],Fe=["all_document"],Se=(r,a)=>{var u;const d=(u=r==null?void 0:r.fields)==null?void 0:u.find(o=>o.fieldname===a);return(d==null?void 0:d.label)||a},Ae=r=>r==null||r===""?"-":r;function ft({isOpen:r,onClose:a,carProfileId:d}){var P;const[u,o]=l.useState(null),{isDark:f,darkColorScheme:c,lightColorScheme:n}=be(),{data:h,isFetching:S}=Ne({doctype:De,fields:JSON.stringify([...ge,...he,...Fe])}),{data:s,isFetching:p,refetch:D}=ve({doctype:De,id:r&&d?d:null,fields:JSON.stringify([...ge,...he,...Fe])});l.useEffect(()=>{r&&d&&D()},[r,d,D]);const C=()=>{if(!s)return;const x=s!=null&&s.all_document&&Array.isArray(s.all_document)&&s.all_document.length>0?s.all_document.map((b,v)=>{const R=(b==null?void 0:b.title)||`Document ${v+1}`,j=b!=null&&b.file?`${ye}${b.file}`:"";return j?`  • ${R}: ${j}`:`  • ${R}`}).join(`
`):"N/A",g=["*Plot Details*","━━━━━━━━━━━━━━━━━━━━",`*Plot No:* ${s.plot_no||"N/A"}`,`*Plot ID:* ${s.plot_id||"N/A"}`,`*Project/Layout:* ${s.project_layout_name||"N/A"}`,`*Location:* ${s.location_village||"N/A"}`,`*Plot Size:* ${s.plot_size||"N/A"}`,`*Plot Type:* ${s.plot_type||"N/A"}`,`*Facing:* ${s.facing||"N/A"}`,`*Total Value:* ${s.total_plot_value?`AED ${parseFloat(s.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Rate per Sqft:* ${s.rate_per_sqft?`AED ${parseFloat(s.rate_per_sqft).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Booking Amount:* ${s.booking_amount?`AED ${parseFloat(s.booking_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Paid Amount:* ${s.paid_amount?`AED ${parseFloat(s.paid_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Balance Amount:* ${s.balance_amount?`AED ${parseFloat(s.balance_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Plot Status:* ${s.plot_status||"N/A"}`,s.remarks?`*Remarks:* ${s.remarks}`:"",`
*All Documents:*`,x].filter(Boolean).join(`
`),F=`https://wa.me/?text=${encodeURIComponent(g)}`;window.open(F,"_blank")};return S||r&&d&&p?e.jsx(G,{show:r,children:e.jsxs(H,{open:r,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(U,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs(U,{as:Z,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl dark:bg-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 pb-4 dark:border-dark-500",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Plot Detail"})}),e.jsx("div",{className:"mt-4",children:e.jsx(je,{style:{"--sk-color":f?c[700]:n[300]}})})]})]})}):s?e.jsx(G,{show:r,children:e.jsxs(H,{open:r,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(U,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs(U,{as:Z,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"scrollbar-sm relative flex max-h-[90vh] w-full max-w-4xl flex-col overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-dark-700",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ae,{className:"size-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Car Information"}),e.jsx("div",{className:"space-y-3",children:ge.map(x=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:Se(h,x)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:Ae(s[x])})]},x))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Additional Information"}),e.jsx("div",{className:"space-y-3",children:he.map(x=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:Se(h,x)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:Ae(s[x])})]},x))})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"All Documents"}),e.jsx("div",{className:"space-y-3",children:(P=s==null?void 0:s.all_document)==null?void 0:P.map((x,g)=>{const k=ye+(x==null?void 0:x.file);return k?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300 mb-1",children:x==null?void 0:x.title}),e.jsx("button",{type:"button",onClick:()=>o(k),className:"inline-flex w-max overflow-hidden rounded-md border border-gray-200 bg-gray-50 hover:bg-gray-100 dark:border-dark-500 dark:bg-dark-600 dark:hover:bg-dark-500",children:e.jsx("img",{src:k,alt:k,className:"h-24 w-24 object-cover"})})]},g):null})})]})})]}),u&&e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/70",onClick:()=>o(null),children:e.jsx("div",{className:"max-h-[90vh] max-w-[90vw] overflow-hidden rounded-lg bg-white p-2 dark:bg-dark-700",onClick:x=>x.stopPropagation(),children:e.jsx("img",{src:u,alt:"Document preview",className:"max-h-[80vh] max-w-[80vw] object-contain"})})}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsxs(y,{variant:"outlined",onClick:C,className:"flex items-center gap-2",children:[e.jsx(qe,{className:"size-4"}),"Share"]}),e.jsx(y,{color:"primary",onClick:a,children:"Close"})]})]})]})}):null}function yt({customerId:r,customerName:a,leadId:d,leadName:u,isCreateMode:o=!1,carProfilesToCreate:f=[],setCarProfilesToCreate:c=null}){const n=a?"customer":"lead",h=n==="customer"?r:d,[S,s]=l.useState(!1),[p,D]=l.useState(!1),[C,P]=l.useState(null),[x,g]=l.useState(null),[k,F]=l.useState(!1),[b,v]=l.useState(null),[R,j]=l.useState(null),M=l.useMemo(()=>["name","lead","lead_status","plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],[]),z=l.useMemo(()=>["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],[]),E=l.useMemo(()=>["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],[]),_=l.useMemo(()=>["plot_status","booking_date","sale_date","handover_date","remarks"],[]),T=l.useMemo(()=>[...M,...z,...E,..._],[M,z,E,_]),[V,W]=l.useState({doctype:"Plot Detail",page:1,page_length:10,fields:o?null:JSON.stringify(T),filters:null}),{data:N,isFetching:K,refetch:$}=Oe(V),[A,q]=l.useState([]);l.useEffect(()=>{if(!o&&h){const m=[[n,"=",h]];n==="lead"?m.push(["lead_status","in",["New","Pending"]]):n==="customer"&&(m.push(["lead_status","!=","New"]),m.push(["lead_status","!=","Pending"]));const i=JSON.stringify(T),O=JSON.stringify(m);W(J=>J.filters===O&&J.fields===i?J:{...J,filters:O,fields:i})}},[h,n,o,T]),l.useEffect(()=>{o?q(f||[]):N!=null&&N.data?q(N.data):q([])},[o,f,N==null?void 0:N.data]);const Q=()=>{P(null),g(null),s(!0)},t=()=>{s(!1),P(null),g(null)},w=()=>{D(!1),P(null),g(null)},L=m=>{if(o&&c)if(x!==null){const i=[...f];i[x]={...m,lead_status:"New"},c(i)}else c([...f,{...m,lead_status:"New"}]);else $();t()},X=Re(m=>{m&&m.success&&(F(!1),v(null),$())}),ue=(m,i,O=null)=>{m.stopPropagation(),P(i),g(O),s(!0)},pe=(m,i)=>{m.stopPropagation(),P(i),D(!0)},He=(m,i,O=null)=>{m.stopPropagation(),v(i),j(O),F(!0)},Ze=(m,i)=>{m.stopPropagation();const O=["*Plot Details*","━━━━━━━━━━━━━━━━━━━━",`*Plot No:* ${i.plot_no||"N/A"}`,`*Plot ID:* ${i.plot_id||"N/A"}`,`*Project/Layout:* ${i.project_layout_name||"N/A"}`,`*Location:* ${i.location_village||"N/A"}`,`*Plot Size:* ${i.plot_size||"N/A"}`,`*Plot Type:* ${i.plot_type||"N/A"}`,`*Facing:* ${i.facing||"N/A"}`,`*Total Value:* ${i.total_plot_value?`AED ${parseFloat(i.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Rate per Sqft:* ${i.rate_per_sqft?`AED ${parseFloat(i.rate_per_sqft).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Booking Amount:* ${i.booking_amount?`AED ${parseFloat(i.booking_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Paid Amount:* ${i.paid_amount?`AED ${parseFloat(i.paid_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Balance Amount:* ${i.balance_amount?`AED ${parseFloat(i.balance_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"N/A"}`,`*Plot Status:* ${i.plot_status||"N/A"}`,`*Lead Status:* ${i.lead_status||"N/A"}`,i.remarks?`*Remarks:* ${i.remarks}`:""].filter(Boolean).join(`
`),Qe=`https://wa.me/?text=${encodeURIComponent(O)}`;window.open(Qe,"_blank")},Ge=()=>{if(o&&c&&R!==null){const m=f.filter((i,O)=>O!==R);c(m),F(!1),v(null),j(null)}else b&&X.mutate({doctype:"Plot Detail",ids:[b]})},Ke=()=>{F(!1),v(null)};return e.jsxs(te,{className:"p-4 sm:px-5",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-dark-50",children:"Plot Details"}),(n==="lead"||o)&&e.jsxs(y,{size:"sm",color:"primary",onClick:Q,className:"flex items-center gap-2",children:[e.jsx(xe,{className:"size-4"}),"Add Plot Detail"]})]}),!o&&!h?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading information..."}):!o&&K?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading plot details..."}):A.length===0?e.jsx("div",{className:"py-8 text-center text-sm text-gray-500 dark:text-dark-300",children:o?"No plot details added yet. Please add at least one plot detail before creating the lead.":`No plot details found ${n==="customer"?"for this customer":"for this lead"}.`}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-dark-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Project/Layout"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Lead Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-dark-200",children:[...A].reverse().map((m,i)=>{const O=A.length-1-i;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-dark-100 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_no||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.project_layout_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.location_village||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_size||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.total_plot_value?`AED ${parseFloat(m.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.plot_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:m.lead_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!o&&e.jsx(y,{size:"sm",variant:"outlined",onClick:J=>pe(J,m.name),className:"p-1.5",children:e.jsx(xt,{className:"size-4"})}),e.jsx(y,{size:"sm",variant:"outlined",onClick:J=>Ze(J,m),className:"p-1.5",title:"Share on WhatsApp",children:e.jsx(qe,{className:"size-4"})}),(n==="lead"||o)&&e.jsx(y,{size:"sm",variant:"outlined",onClick:J=>ue(J,o?null:m.name,o?O:null),className:"p-1.5",children:e.jsx(Je,{className:"size-4"})}),e.jsx(y,{size:"sm",variant:"outlined",color:"error",onClick:J=>He(J,o?null:m.name,o?O:null),className:"p-1.5",disabled:!o&&X.isPending,children:e.jsx(_e,{className:"size-4"})})]})})]},o?O:m.name)})})]})}),e.jsx(ht,{isOpen:S,onClose:t,carProfileId:C,carProfileData:o&&x!==null?f[x]:null,customerId:r,customerName:a,leadId:d,leadName:u,isCreateMode:o,onSuccess:L}),e.jsx(ft,{isOpen:p,onClose:w,carProfileId:C}),e.jsx(Me,{show:k,onClose:Ke,onOk:Ge,confirmLoading:X.isPending,state:X.isError?"error":"pending",messages:{pending:{title:"Delete Plot Detail?",description:"Are you sure you want to delete this plot detail? This action cannot be undone.",actionText:"Delete"}}})]})}const fe="Lead",ne=["first_name","last_name","email_id","mobile_no","custom_address"],oe=["custom_next_follow_up_date","source","custom_followup_history","custom_assigned_user","custom_lead_status"],Ce={ignorFields:{status:!0,custom_followup_history:!0}};function Ot(){var E;const a=typeof window<"u"&&window.localStorage&&(localStorage.getItem("salesPurchaseType")||"sales")==="sales"?"Customer":"Land Owner",{user:{username:d}}=at(),{isDark:u,darkColorScheme:o,lightColorScheme:f}=be(),c=st(),{id:n}=rt(),{data:h,isFetching:S}=Ne({doctype:fe,fields:JSON.stringify([...ne,...oe])}),{data:s,isFetching:p,refetch:D}=ve({doctype:fe,id:n,fields:JSON.stringify([...ne,...oe])}),[C,P]=l.useState([]),[x,g]=l.useState(!1),k=me(_=>{_&&(j(),c(-1))}),{register:F,handleSubmit:b,formState:{errors:v},control:R,reset:j,setValue:M}=Te({resolver:ze(Le((E=h==null?void 0:h.fields)==null?void 0:E.filter(_=>_.fieldname!=="status"))),values:n?s:{},defaultValues:Object.fromEntries([...ne,...oe].map(_=>[_,""]))}),z=async _=>{if(n){const T={..._,custom_lead_type:a==="Customer"?"sales":"purchase"};k.mutate({doctype:fe,body:{...T,custom_lead_type:a==="Customer"?"sales":"purchase",id:n}})}else{g(!0);try{const T={..._,status:"Open"},V=await lt(T,C,d);if(!V||!V.lead_id&&!V.customer_id)throw new Error("Failed to create lead");j(),P([]),c(-1)}catch(T){console.error("Error creating lead:",T),Y(T)}finally{g(!1)}}};return S||p?e.jsx(je,{style:{"--sk-color":u?o[700]:f[300]}}):e.jsx(dt,{title:(n?"Edit ":"New ")+a,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ct,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[n?"Edit":"New"," ",a]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>c(-1),children:"Back"}),e.jsx(y,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",disabled:x,children:x?"Creating...":"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:b(z),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx(gt,{id:n,data:s,setValue:M,refetchData:D}),e.jsx(pt,{id:n,data:s,setValue:M,refetchData:D}),e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(ee,{infos:h,fields:ne,register:F,tables:Ce,control:R,errors:v})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-5 lg:space-y-6",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsx(ee,{infos:h,tables:Ce,fields:oe,register:F,control:R,errors:v,readOnlyFields:["custom_lead_status","custom_next_follow_up_date"]})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(yt,{leadId:n,customerId:s==null?void 0:s.customer,leadName:(s==null?void 0:s.lead_name)||(s==null?void 0:s.name),isCreateMode:!n,carProfilesToCreate:C,setCarProfilesToCreate:P})})]})]})})}export{Ot as default};
