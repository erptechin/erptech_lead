import{a as n,u as me,j as e,S as xe,B as D,I as Ae,k as le,U as $e,J as be,C as de,e as Ve,l as Je,n as Re,o as Ue,s as Be}from"./index-EG-ekBwM.js";import{u as je,o as Ne,a as Oe,C as We}from"./index.esm-CJMWS-L-.js";import{S as _e,F as ve,D as O,a as qe}from"./dynamicForms-VOZHnPO6.js";import{P as Ze}from"./Page-myfBFfgr.js";import{u as ue,b as pe,c as He,d as we,y as X,j as Y,a as Ie,e as Ge,C as Ke}from"./ConfirmModal-Cw3llu_8.js";import{F as Fe,a as Qe}from"./TrashIcon-BLqER9zX.js";import{z as M,F as $}from"./transition-Dk28wmW0.js";import{F as Xe}from"./DocumentPlusIcon-DPbNWCtL.js";import"./iconBase-Dsq9K52i.js";import"./use-event-listener-DSPaWXD_.js";import"./Datepicker-BGRa2XgP.js";import"./combobox-CPERt7d_.js";import"./use-by-comparator-Ujjs6076.js";import"./calculate-active-index-hw3FfNxI.js";import"./useMutation-CoOmEsem.js";import"./floating-ui.dom-CtcSe9Ld.js";function Ye({title:t,titleId:a,...l},m){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":a},l),t?n.createElement("title",{id:a},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Me=n.forwardRef(Ye);function et({title:t,titleId:a,...l},m){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":a},l),t?n.createElement("title",{id:a},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Se=n.forwardRef(et),H="Plot Detail",De=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],Pe=["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],ze=["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],Ee=["plot_status","booking_date","sale_date","handover_date","remarks"],ce=[...De,...Pe,...ze,...Ee],I={ignorFields:{all_document:!0}},Q=Object.fromEntries(ce.map(t=>[t,""]));Q.all_document=[];function tt({isOpen:t,onClose:a,carProfileId:l,carProfileData:m=null,customerId:s,customerName:v,leadId:u,leadName:i,isCreateMode:d=!1,onSuccess:w}){const{isDark:c,darkColorScheme:V,lightColorScheme:T}=me(),{data:p,isFetching:o}=ue({doctype:H,fields:JSON.stringify(ce)}),{data:f,isFetching:b,refetch:J}=pe({doctype:H,id:t&&l&&!d?l:null,fields:JSON.stringify(ce)});n.useEffect(()=>{t&&l&&!d&&J()},[t,l,d,J]);const y=He(()=>{x(),w&&w(),a()}),F=we(()=>{x(),w&&w(),a()}),{register:N,handleSubmit:L,formState:{errors:_,isSubmitting:R},control:P,reset:x,setValue:h}=je({resolver:Ne(_e(p==null?void 0:p.fields)),defaultValues:Q,mode:"onChange"}),{fields:U,append:ee,remove:te}=Oe({control:P,name:"all_document"});n.useEffect(()=>{if(t)if(d&&m){const k={...m,all_document:Array.isArray(m.all_document)?m.all_document:[]};x(k)}else if(l&&!d){if(f){const k={...f,all_document:Array.isArray(f.all_document)?f.all_document:[]};x(k)}}else x(Q),d||(s&&h("customer",s),u?h("lead",u):i&&h("lead",i));else x(Q)},[t,l,m,d,f,s,v,u,i,x,h]);const z=k=>{if(console.log("Form submitted with data:",k),d){const C={...k};(u||i)&&(C.status="New"),w&&w(C);return}const g={...k};g.lead=u,g.customer=s,console.log("Submitting with data:",g),l?(console.log("Calling mutationUpdate..."),F.mutate({doctype:H,body:{...g,id:l}})):(g.status="New",console.log("Calling mutationAdd..."),y.mutate({doctype:H,body:g}))},q=k=>{console.log("Form validation errors:",k)};return o||t&&l&&!d&&b?e.jsx(M,{show:t,children:e.jsxs(X,{open:t,onClose:a,static:!1,autoFocus:!0,children:[e.jsx($,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!y.isPending&&!F.isPending&&a()}}),e.jsx($,{as:Y,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[l?"Edit":"New"," Plot Detail"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsx(xe,{style:{"--sk-color":c?V[700]:T[300]}})})]})})]})}):e.jsx(M,{show:t,children:e.jsxs(X,{open:t,onClose:k=>{!y.isPending&&!F.isPending&&a()},static:y.isPending||F.isPending,autoFocus:!0,children:[e.jsx($,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!y.isPending&&!F.isPending&&a()}}),e.jsxs($,{as:Y,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[l?"Edit":"New"," Plot Detail"]}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ve,{className:"size-5"})})]}),e.jsxs("form",{onSubmit:L(z,q),className:"flex min-h-0 flex-1 flex-col overflow-hidden",noValidate:!0,children:[e.jsxs("div",{className:"scrollbar-sm flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-5 sm:gap-5 lg:gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Basic Plot Details"}),e.jsx(O,{infos:p,fields:De,register:N,tables:I,control:P,errors:_})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Ownership & Legal"}),e.jsx(O,{infos:p,fields:Pe,register:N,tables:I,control:P,errors:_})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Financial Details"}),e.jsx(O,{infos:p,fields:ze,register:N,tables:I,control:P,errors:_})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Status Tracking"}),e.jsx(O,{infos:p,fields:Ee,register:N,tables:I,control:P,errors:_})]})]})]}),e.jsxs("div",{className:"px-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b pb-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-dark-100",children:"Plot Documents"}),e.jsxs(D,{type:"button",variant:"flat",size:"sm",onClick:()=>ee({title:"",file:""}),className:"gap-1",children:[e.jsx(Se,{className:"size-4"}),"Add Document"]})]}),e.jsxs("div",{className:"space-y-4",children:[U.map((k,g)=>{var C,Z,W;return e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4 dark:border-dark-500",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-dark-300",children:["Document ",g+1]}),e.jsxs(D,{type:"button",variant:"flat",size:"sm",color:"error",onClick:()=>te(g),className:"gap-1",children:[e.jsx(Fe,{className:"size-4"}),"Remove"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ae,{label:"Title",placeholder:"Enter document title",...N(`all_document.${g}.title`),error:(W=(Z=(C=_==null?void 0:_.all_document)==null?void 0:C[g])==null?void 0:Z.title)==null?void 0:W.message}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-200",children:"File"}),e.jsx(We,{name:`all_document.${g}.file`,control:P,render:({field:{value:A,onChange:se}})=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:le("flex-1",A&&"max-w-[60%]"),children:e.jsx($e,{onChange:se,accept:"image/*",children:({onClick:B,disabled:ae,...re})=>e.jsxs(D,{...re,type:"button",unstyled:!0,onClick:B,disabled:ae,className:le("mt-1 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-6 border-gray-300 dark:border-dark-450","hover:border-primary-400 dark:hover:border-primary-500"),children:[e.jsx(qe,{className:"size-8 text-gray-400 dark:text-dark-400"}),e.jsxs("span",{className:le("pointer-events-none mt-2 text-sm text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your file here"})]}),A&&e.jsx("span",{className:"mt-2 text-xs text-gray-500 dark:text-dark-300",children:"File selected"})]})})}),A&&e.jsx("div",{className:"mt-1 flex-shrink-0",children:e.jsx("img",{src:A.startsWith("http")?A:`${be}${A}`,alt:"Preview",className:"h-32 w-32 rounded border border-gray-200 object-cover dark:border-dark-500"})})]})})]})]})]},k.id)}),U.length===0&&e.jsx("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center dark:border-dark-500",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:'No documents added. Click "Add Document" to add one.'})})]})]})]}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(D,{variant:"outlined",onClick:a,children:"Cancel"}),e.jsx(D,{color:"primary",type:"button",onClick:L(z,q),disabled:R||y.isPending||F.isPending,children:R||y.isPending||F.isPending?"Saving...":l?"Update":"Create"})]})]})]})]})})}const he="Plot Detail",ne=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],oe=["status","owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status","rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","buyer_name","contact_number","email_id","address","agent_reference_name","plot_status","booking_date","sale_date","handover_date","remarks"],ge=["all_document"],fe=(t,a)=>{var m;const l=(m=t==null?void 0:t.fields)==null?void 0:m.find(s=>s.fieldname===a);return(l==null?void 0:l.label)||a},ye=t=>t==null||t===""?"-":t;function st({isOpen:t,onClose:a,carProfileId:l}){var p;const[m,s]=n.useState(null),{isDark:v,darkColorScheme:u,lightColorScheme:i}=me(),{data:d,isFetching:w}=ue({doctype:he,fields:JSON.stringify([...ne,...oe,...ge])}),{data:c,isFetching:V,refetch:T}=pe({doctype:he,id:t&&l?l:null,fields:JSON.stringify([...ne,...oe,...ge])});return n.useEffect(()=>{t&&l&&T()},[t,l,T]),w||t&&l&&V?e.jsx(M,{show:t,children:e.jsxs(X,{open:t,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx($,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs($,{as:Y,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl dark:bg-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 pb-4 dark:border-dark-500",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Plot Detail"})}),e.jsx("div",{className:"mt-4",children:e.jsx(xe,{style:{"--sk-color":v?u[700]:i[300]}})})]})]})}):c?e.jsx(M,{show:t,children:e.jsxs(X,{open:t,onClose:a,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx($,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:a}),e.jsxs($,{as:Y,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"scrollbar-sm relative flex max-h-[90vh] w-full max-w-4xl flex-col overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-dark-700",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"}),e.jsx("button",{onClick:a,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(ve,{className:"size-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Car Information"}),e.jsx("div",{className:"space-y-3",children:ne.map(o=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:fe(d,o)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:ye(c[o])})]},o))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Additional Information"}),e.jsx("div",{className:"space-y-3",children:oe.map(o=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:fe(d,o)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:ye(c[o])})]},o))})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Plot Documents"}),e.jsx("div",{className:"space-y-3",children:(p=c==null?void 0:c.all_document)==null?void 0:p.map((o,f)=>{const b=be+(o==null?void 0:o.file);return b?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300 mb-1",children:o==null?void 0:o.title}),e.jsx("button",{type:"button",onClick:()=>s(b),className:"inline-flex w-max overflow-hidden rounded-md border border-gray-200 bg-gray-50 hover:bg-gray-100 dark:border-dark-500 dark:bg-dark-600 dark:hover:bg-dark-500",children:e.jsx("img",{src:b,alt:b,className:"h-24 w-24 object-cover"})})]},f):null})})]})})]}),m&&e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/70",onClick:()=>s(null),children:e.jsx("div",{className:"max-h-[90vh] max-w-[90vw] overflow-hidden rounded-lg bg-white p-2 dark:bg-dark-700",onClick:o=>o.stopPropagation(),children:e.jsx("img",{src:m,alt:"Document preview",className:"max-h-[80vh] max-w-[80vw] object-contain"})})}),e.jsx("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 dark:border-dark-500",children:e.jsx(D,{color:"primary",onClick:a,children:"Close"})})]})]})}):null}function at({customerId:t,customerName:a,leadId:l,leadName:m,isCreateMode:s=!1,carProfilesToCreate:v=[],setCarProfilesToCreate:u=null}){const i=a?"customer":"lead",d=i==="customer"?t:l,[w,c]=n.useState(!1),[V,T]=n.useState(!1),[p,o]=n.useState(null),[f,b]=n.useState(null),[J,y]=n.useState(!1),[F,N]=n.useState(null),[L,_]=n.useState(null),R=n.useMemo(()=>["name","lead","lead_status","plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],[]),P=n.useMemo(()=>["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],[]),x=n.useMemo(()=>["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],[]),h=n.useMemo(()=>["plot_status","booking_date","sale_date","handover_date","remarks"],[]),U=n.useMemo(()=>[...R,...P,...x,...h],[R,P,x,h]),[ee,te]=n.useState({doctype:"Plot Detail",page:1,page_length:10,fields:s?null:JSON.stringify(U),filters:null}),{data:z,isFetching:q,refetch:k}=Ie(ee),[g,C]=n.useState([]);n.useEffect(()=>{if(!s&&d){const r=[[i,"=",d]];i==="lead"?r.push(["lead_status","in",["New","Pending"]]):i==="customer"&&(r.push(["lead_status","!=","New"]),r.push(["lead_status","!=","Pending"]));const j=JSON.stringify(U),S=JSON.stringify(r);te(E=>E.filters===S&&E.fields===j?E:{...E,filters:S,fields:j})}},[d,i,s,U]),n.useEffect(()=>{s?C(v||[]):z!=null&&z.data?C(z.data):C([])},[s,v,z==null?void 0:z.data]);const Z=()=>{o(null),b(null),c(!0)},W=()=>{c(!1),o(null),b(null)},A=()=>{T(!1),o(null),b(null)},se=r=>{if(s&&u)if(f!==null){const j=[...v];j[f]=r,u(j)}else u([...v,r]);else k();W()},B=Ge(r=>{r&&r.success&&(y(!1),N(null),k())}),ae=(r,j,S=null)=>{r.stopPropagation(),o(j),b(S),c(!0)},re=(r,j)=>{r.stopPropagation(),o(j),T(!0)},Ce=(r,j,S=null)=>{r.stopPropagation(),N(j),_(S),y(!0)},Te=()=>{if(s&&u&&L!==null){const r=v.filter((j,S)=>S!==L);u(r),y(!1),N(null),_(null)}else F&&B.mutate({doctype:"Plot Detail",ids:[F]})},Le=()=>{y(!1),N(null)};return e.jsxs(de,{className:"p-4 sm:px-5",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-dark-50",children:"Plot Details"}),(i==="lead"||s)&&e.jsxs(D,{size:"sm",color:"primary",onClick:Z,className:"flex items-center gap-2",children:[e.jsx(Se,{className:"size-4"}),"Add Plot Detail"]})]}),!s&&!d?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading information..."}):!s&&q?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading plot details..."}):g.length===0?e.jsx("div",{className:"py-8 text-center text-sm text-gray-500 dark:text-dark-300",children:s?"No plot details added yet. Please add at least one plot detail before creating the lead.":`No plot details found ${i==="customer"?"for this customer":"for this lead"}.`}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-dark-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Project/Layout"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Lead Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-dark-200",children:[...g].reverse().map((r,j)=>{const S=g.length-1-j;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-dark-100 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.plot_no||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.plot_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.project_layout_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.location_village||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.plot_size||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.total_plot_value?`AED ${parseFloat(r.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.plot_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:r.lead_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!s&&e.jsx(D,{size:"sm",variant:"outlined",onClick:E=>re(E,r.name),className:"p-1.5",children:e.jsx(Me,{className:"size-4"})}),(i==="lead"||s)&&e.jsx(D,{size:"sm",variant:"outlined",onClick:E=>ae(E,s?null:r.name,s?S:null),className:"p-1.5",children:e.jsx(Qe,{className:"size-4"})}),e.jsx(D,{size:"sm",variant:"outlined",color:"error",onClick:E=>Ce(E,s?null:r.name,s?S:null),className:"p-1.5",disabled:!s&&B.isPending,children:e.jsx(Fe,{className:"size-4"})})]})})]},s?S:r.name)})})]})}),e.jsx(tt,{isOpen:w,onClose:W,carProfileId:p,carProfileData:s&&f!==null?v[f]:null,customerId:t,customerName:a,leadId:l,leadName:m,isCreateMode:s,onSuccess:se}),e.jsx(st,{isOpen:V,onClose:A,carProfileId:p}),e.jsx(Ke,{show:J,onClose:Le,onOk:Te,confirmLoading:B.isPending,state:B.isError?"error":"pending",messages:{pending:{title:"Delete Plot Detail?",description:"Are you sure you want to delete this plot detail? This action cannot be undone.",actionText:"Delete"}}})]})}const ie="Lead",G=["first_name","last_name","email_id","mobile_no","custom_address"],K=["custom_next_follow_up_date","source","custom_followup_history","custom_assigned_user","custom_lead_status"],ke={ignorFields:{status:!0,custom_followup_history:!0}};function bt(){const a=typeof window<"u"&&window.localStorage&&(localStorage.getItem("salesPurchaseType")||"sales")==="sales"?"Customer":"Land Owner",{user:{username:l}}=Ve(),{isDark:m,darkColorScheme:s,lightColorScheme:v}=me(),u=Je(),{id:i}=Re(),{data:d,isFetching:w}=ue({doctype:ie,fields:JSON.stringify([...G,...K])}),{data:c,isFetching:V,refetch:T}=pe({doctype:ie,id:i,fields:JSON.stringify([...G,...K])}),[p,o]=n.useState([]),[f,b]=n.useState(!1),J=we(x=>{x&&(_(),u(-1))}),{register:y,handleSubmit:F,formState:{errors:N},control:L,reset:_,setValue:R}=je({resolver:Ne(_e(d==null?void 0:d.fields,["status"])),values:i?c:{},defaultValues:Object.fromEntries([...G,...K].map(x=>[x,""]))}),P=async x=>{if(i){const h={...x,custom_lead_type:a==="Customer"?"sales":"purchase"};J.mutate({doctype:ie,body:{...h,custom_lead_type:a==="Customer"?"sales":"purchase",id:i}})}else{b(!0);try{const h=await Ue(x,p,l);if(!h||!h.lead_id&&!h.customer_id)throw new Error("Failed to create lead");_(),o([]),u(-1)}catch(h){console.error("Error creating lead:",h),Be(h)}finally{b(!1)}}};return w||V?e.jsx(xe,{style:{"--sk-color":m?s[700]:v[300]}}):e.jsx(Ze,{title:(i?"Edit ":"New ")+a,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[i?"Edit":"New"," ",a]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>u(-1),children:"Back"}),e.jsx(D,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",disabled:f,children:f?"Creating...":"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:F(P),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(de,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(O,{infos:d,fields:G,register:y,tables:ke,control:L,errors:N})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-5 lg:space-y-6",children:e.jsx(de,{className:"p-4 sm:px-5",children:e.jsx(O,{infos:d,tables:ke,fields:K,register:y,control:L,errors:N,readOnlyFields:["custom_lead_status","custom_next_follow_up_date"]})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(at,{leadId:i,customerId:c==null?void 0:c.customer,leadName:(c==null?void 0:c.lead_name)||(c==null?void 0:c.name),isCreateMode:!i,carProfilesToCreate:p,setCarProfilesToCreate:o})})]})]})})}export{bt as default};
