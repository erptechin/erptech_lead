import{a as n,u as se,j as e,S as le,B as E,C as te,e as Ee,k as ze,p as Te,q as Le,s as Ve}from"./index-CJRJqnsH.js";import{u as ue,o as pe}from"./index.esm-V0F7KxiS.js";import{S as fe,F as he,D as A}from"./dynamicForms-C-JCNn0e.js";import{P as Ce}from"./Page-BsHwRLDp.js";import{u as re,b as ne,c as $e,d as ge,a as Ae,e as Je}from"./useApiHook-C01NVG9t.js";import{y as G,j as H,C as Re}from"./ConfirmModal-BS7xllLh.js";import{z as K,F as L}from"./transition-5Qb9_UG4.js";import{F as Be,a as Ue}from"./TrashIcon-C6ysQwAk.js";import{F as qe}from"./DocumentPlusIcon-vxcJTkwB.js";import"./iconBase-BdmEsFzV.js";import"./use-event-listener-D5kU_-Xm.js";import"./hidden-BHNy7nSf.js";import"./Datepicker-Bo1yItUk.js";import"./combobox-3_tA7yLX.js";import"./use-by-comparator-BWmyeU67.js";import"./calculate-active-index--ml5kCCw.js";import"./use-tree-walker-C25vrnB6.js";import"./label-CKdmR3y7.js";import"./frozen-CMBgJLoW.js";import"./useMutation-D7BC6cx2.js";import"./floating-ui.dom-CtcSe9Ld.js";function Oe({title:t,titleId:r,...l},x){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":r},l),t?n.createElement("title",{id:r},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const We=n.forwardRef(Oe);function Ze({title:t,titleId:r,...l},x){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":r},l),t?n.createElement("title",{id:r},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Ge=n.forwardRef(Ze),q="Plot Detail",ye=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],ke=["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],be=["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],je=["plot_status","booking_date","sale_date","handover_date","remarks","attach_file"],ae=[...ye,...ke,...be,...je],O={ignorFields:{}},Y=Object.fromEntries(ae.map(t=>[t,""]));function He({isOpen:t,onClose:r,carProfileId:l,carProfileData:x=null,customerId:a,customerName:k,leadId:c,leadName:i,isCreateMode:o=!1,onSuccess:b}){const{isDark:d,darkColorScheme:g,lightColorScheme:J}=se(),{data:y,isFetching:w}=re({doctype:q,fields:JSON.stringify(ae)}),{data:v,isFetching:D,refetch:V}=ne({doctype:q,id:t&&l&&!o?l:null,fields:JSON.stringify(ae)});n.useEffect(()=>{t&&l&&!o&&V()},[t,l,o,V]);const p=$e(()=>{m(),b&&b(),r()}),j=ge(()=>{m(),b&&b(),r()}),{register:_,handleSubmit:z,formState:{errors:F,isSubmitting:C},control:P,reset:m,setValue:u}=ue({resolver:pe(fe(y==null?void 0:y.fields)),defaultValues:Y,mode:"onChange"});n.useEffect(()=>{t?o&&x?m(x):l&&!o?v&&m(v):(m(Y),o||(a&&u("customer",a),c?u("lead",c):i&&u("lead",i))):m(Y)},[t,l,x,o,v,a,k,c,i,m,u]);const $=T=>{if(console.log("Form submitted with data:",T),o){const B={...T};(c||i)&&(B.status="New"),b&&b(B);return}const f={...T};f.lead=c,f.customer=a,console.log("Submitting with data:",f),l?(console.log("Calling mutationUpdate..."),j.mutate({doctype:q,body:{...f,id:l}})):(f.status="New",console.log("Calling mutationAdd..."),p.mutate({doctype:q,body:f}))},R=T=>{console.log("Form validation errors:",T)};return w||t&&l&&!o&&D?e.jsx(K,{show:t,children:e.jsxs(G,{open:t,onClose:r,static:!1,autoFocus:!0,children:[e.jsx(L,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!p.isPending&&!j.isPending&&r()}}),e.jsx(L,{as:H,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[l?"Edit":"New"," Plot Detail"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsx(le,{style:{"--sk-color":d?g[700]:J[300]}})})]})})]})}):e.jsx(K,{show:t,children:e.jsxs(G,{open:t,onClose:T=>{!p.isPending&&!j.isPending&&r()},static:p.isPending||j.isPending,autoFocus:!0,children:[e.jsx(L,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!p.isPending&&!j.isPending&&r()}}),e.jsxs(L,{as:H,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[l?"Edit":"New"," Plot Detail"]}),e.jsx("button",{onClick:r,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(he,{className:"size-5"})})]}),e.jsxs("form",{onSubmit:z($,R),className:"flex min-h-0 flex-1 flex-col overflow-hidden",noValidate:!0,children:[e.jsx("div",{className:"scrollbar-sm flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-5 sm:gap-5 lg:gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Basic Plot Details"}),e.jsx(A,{infos:y,fields:ye,register:_,tables:O,control:P,errors:F})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Ownership & Legal"}),e.jsx(A,{infos:y,fields:ke,register:_,tables:O,control:P,errors:F})]})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Financial Details"}),e.jsx(A,{infos:y,fields:be,register:_,tables:O,control:P,errors:F})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-dark-100 border-b pb-2",children:"Status Tracking"}),e.jsx(A,{infos:y,fields:je,register:_,tables:O,control:P,errors:F})]})]})]})}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(E,{variant:"outlined",onClick:r,children:"Cancel"}),e.jsx(E,{color:"primary",type:"button",onClick:z($,R),disabled:C||p.isPending||j.isPending,children:C||p.isPending||j.isPending?"Saving...":l?"Update":"Create"})]})]})]})]})})}const de="Plot Detail",I=["plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],M=["status","owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status","rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","buyer_name","contact_number","email_id","address","agent_reference_name","plot_status","booking_date","sale_date","handover_date","remarks"],ce=(t,r)=>{var x;const l=(x=t==null?void 0:t.fields)==null?void 0:x.find(a=>a.fieldname===r);return(l==null?void 0:l.label)||r},me=t=>t==null||t===""?"-":t;function Ke({isOpen:t,onClose:r,carProfileId:l}){const{isDark:x,darkColorScheme:a,lightColorScheme:k}=se(),{data:c,isFetching:i}=re({doctype:de,fields:JSON.stringify([...I,...M])}),{data:o,isFetching:b,refetch:d}=ne({doctype:de,id:t&&l?l:null,fields:JSON.stringify([...I,...M])});return n.useEffect(()=>{t&&l&&d()},[t,l,d]),i||t&&l&&b?e.jsx(K,{show:t,children:e.jsxs(G,{open:t,onClose:r,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(L,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:r}),e.jsxs(L,{as:H,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl dark:bg-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 pb-4 dark:border-dark-500",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Plot Detail"})}),e.jsx("div",{className:"mt-4",children:e.jsx(le,{style:{"--sk-color":x?a[700]:k[300]}})})]})]})}):o?e.jsx(K,{show:t,children:e.jsxs(G,{open:t,onClose:r,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(L,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:r}),e.jsxs(L,{as:H,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"scrollbar-sm relative flex max-h-[90vh] w-full max-w-4xl flex-col overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-dark-700",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"}),e.jsx("button",{onClick:r,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(he,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Car Information"}),e.jsx("div",{className:"space-y-3",children:I.map(g=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:ce(c,g)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:me(o[g])})]},g))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Additional Information"}),e.jsx("div",{className:"space-y-3",children:M.map(g=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:ce(c,g)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:me(o[g])})]},g))})]})]})}),e.jsx("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 dark:border-dark-500",children:e.jsx(E,{color:"primary",onClick:r,children:"Close"})})]})]})}):null}function Qe({customerId:t,customerName:r,leadId:l,leadName:x,isCreateMode:a=!1,carProfilesToCreate:k=[],setCarProfilesToCreate:c=null}){const i=r?"customer":"lead",o=i==="customer"?t:l,[b,d]=n.useState(!1),[g,J]=n.useState(!1),[y,w]=n.useState(null),[v,D]=n.useState(null),[V,p]=n.useState(!1),[j,_]=n.useState(null),[z,F]=n.useState(null),C=n.useMemo(()=>["name","lead","lead_status","plot_no","plot_id","project_layout_name","location_village","survey_no","plot_type","plot_size","length","width","facing"],[]),P=n.useMemo(()=>["owner_name","document_no","registration_date","patta_khata_no","approval_authority","legal_status"],[]),m=n.useMemo(()=>["rate_per_sqft","total_plot_value","booking_amount","paid_amount","balance_amount","payment_mode","payment_date","agent_reference_name"],[]),u=n.useMemo(()=>["plot_status","booking_date","sale_date","handover_date","remarks"],[]),$=n.useMemo(()=>[...C,...P,...m,...u],[C,P,m,u]),[R,T]=n.useState({doctype:"Plot Detail",page:1,page_length:10,fields:a?null:JSON.stringify($),filters:null}),{data:f,isFetching:B,refetch:ie}=Ae(R),[Q,X]=n.useState([]);n.useEffect(()=>{if(!a&&o){const s=[[i,"=",o]];i==="lead"?s.push(["lead_status","in",["New","Pending"]]):i==="customer"&&(s.push(["lead_status","!=","New"]),s.push(["lead_status","!=","Pending"]));const h=JSON.stringify($),N=JSON.stringify(s);T(S=>S.filters===N&&S.fields===h?S:{...S,filters:N,fields:h})}},[o,i,a,$]),n.useEffect(()=>{a?X(k||[]):f!=null&&f.data?X(f.data):X([])},[a,k,f==null?void 0:f.data]);const _e=()=>{w(null),D(null),d(!0)},oe=()=>{d(!1),w(null),D(null)},Ne=()=>{J(!1),w(null),D(null)},ve=s=>{if(a&&c)if(v!==null){const h=[...k];h[v]=s,c(h)}else c([...k,s]);else ie();oe()},U=Je(s=>{s&&s.success&&(p(!1),_(null),ie())}),we=(s,h,N=null)=>{s.stopPropagation(),w(h),D(N),d(!0)},Fe=(s,h)=>{s.stopPropagation(),w(h),J(!0)},Se=(s,h,N=null)=>{s.stopPropagation(),_(h),F(N),p(!0)},De=()=>{if(a&&c&&z!==null){const s=k.filter((h,N)=>N!==z);c(s),p(!1),_(null),F(null)}else j&&U.mutate({doctype:"Plot Detail",ids:[j]})},Pe=()=>{p(!1),_(null)};return e.jsxs(te,{className:"p-4 sm:px-5",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-dark-50",children:"Plot Details"}),(i==="lead"||a)&&e.jsxs(E,{size:"sm",color:"primary",onClick:_e,className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"size-4"}),"Add Plot Detail"]})]}),!a&&!o?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading information..."}):!a&&B?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading plot details..."}):Q.length===0?e.jsx("div",{className:"py-8 text-center text-sm text-gray-500 dark:text-dark-300",children:a?"No plot details added yet. Please add at least one plot detail before creating the lead.":`No plot details found ${i==="customer"?"for this customer":"for this lead"}.`}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-dark-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Project/Layout"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Plot Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Lead Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 dark:text-dark-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-dark-200",children:[...Q].reverse().map((s,h)=>{const N=Q.length-1-h;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-dark-100 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.plot_no||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.plot_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.project_layout_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.location_village||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.plot_size||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.total_plot_value?`AED ${parseFloat(s.total_plot_value).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.plot_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-dark-50",children:s.lead_status||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!a&&e.jsx(E,{size:"sm",variant:"outlined",onClick:S=>Fe(S,s.name),className:"p-1.5",children:e.jsx(We,{className:"size-4"})}),(i==="lead"||a)&&e.jsx(E,{size:"sm",variant:"outlined",onClick:S=>we(S,a?null:s.name,a?N:null),className:"p-1.5",children:e.jsx(Be,{className:"size-4"})}),e.jsx(E,{size:"sm",variant:"outlined",color:"error",onClick:S=>Se(S,a?null:s.name,a?N:null),className:"p-1.5",disabled:!a&&U.isPending,children:e.jsx(Ue,{className:"size-4"})})]})})]},a?N:s.name)})})]})}),e.jsx(He,{isOpen:b,onClose:oe,carProfileId:y,carProfileData:a&&v!==null?k[v]:null,customerId:t,customerName:r,leadId:l,leadName:x,isCreateMode:a,onSuccess:ve}),e.jsx(Ke,{isOpen:g,onClose:Ne,carProfileId:y}),e.jsx(Re,{show:V,onClose:Pe,onOk:De,confirmLoading:U.isPending,state:U.isError?"error":"pending",messages:{pending:{title:"Delete Plot Detail?",description:"Are you sure you want to delete this plot detail? This action cannot be undone.",actionText:"Delete"}}})]})}const ee="Lead",W=["first_name","last_name","email_id","mobile_no","custom_address"],Z=["custom_next_follow_up_date","source","custom_followup_history","custom_assigned_user","custom_lead_status"],xe={ignorFields:{status:!0,custom_followup_history:!0}};function gt(){const r=typeof window<"u"&&window.localStorage&&(localStorage.getItem("salesPurchaseType")||"sales")==="sales"?"Customer":"Land Owner",{user:{username:l}}=Ee(),{isDark:x,darkColorScheme:a,lightColorScheme:k}=se(),c=ze(),{id:i}=Te(),{data:o,isFetching:b}=re({doctype:ee,fields:JSON.stringify([...W,...Z])}),{data:d,isFetching:g,refetch:J}=ne({doctype:ee,id:i,fields:JSON.stringify([...W,...Z])}),[y,w]=n.useState([]),[v,D]=n.useState(!1),V=ge(m=>{m&&(F(),c(-1))}),{register:p,handleSubmit:j,formState:{errors:_},control:z,reset:F,setValue:C}=ue({resolver:pe(fe(o==null?void 0:o.fields,["status"])),values:i?d:{},defaultValues:Object.fromEntries([...W,...Z].map(m=>[m,""]))}),P=async m=>{if(i){const u={...m};V.mutate({doctype:ee,body:{...u,id:i}})}else{D(!0);try{const u=await Le(m,y,l);if(!u||!u.lead_id&&!u.customer_id)throw new Error("Failed to create lead");F(),w([]),c(-1)}catch(u){console.error("Error creating lead:",u),Ve(u)}finally{D(!1)}}};return b||g?e.jsx(le,{style:{"--sk-color":x?a[700]:k[300]}}):e.jsx(Ce,{title:(i?"Edit ":"New ")+r,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[i?"Edit":"New"," ",r]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>c(-1),children:"Back"}),e.jsx(E,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",disabled:v,children:v?"Creating...":"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:j(P),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(A,{infos:o,fields:W,register:p,tables:xe,control:z,errors:_})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-5 lg:space-y-6",children:e.jsx(te,{className:"p-4 sm:px-5",children:e.jsx(A,{infos:o,tables:xe,fields:Z,register:p,control:z,errors:_,readOnlyFields:["custom_lead_status","custom_next_follow_up_date"]})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Qe,{leadId:i,customerId:d==null?void 0:d.customer,leadName:(d==null?void 0:d.lead_name)||(d==null?void 0:d.name),isCreateMode:!i,carProfilesToCreate:y,setCarProfilesToCreate:w})})]})]})})}export{gt as default};
