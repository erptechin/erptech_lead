import{a as n,u as re,y as Q,j as e,S as ie,B as F,C as ce,q as de,s as me,t as X,v as C,w as xe,x as P}from"./index-CXdK2mEz.js";import{u as ne,b as le,c as ue,d as fe,a as he,e as ge}from"./useApiHook-2VTEyIvN.js";import{u as pe,o as ye,a as je}from"./index.esm-D1RJ0A51.js";import{S as ke,F as oe,D as I}from"./dynamicForms-C35dwID1.js";import{z as O,F as w}from"./transition-BEPJcKhE.js";import{y as W,j as Z}from"./iconBase-Y2Q2gnGj.js";import{C as be}from"./ConfirmModal-DzIkVamt.js";import{F as ve,a as we}from"./TrashIcon-BD_EzTt_.js";function _e({title:a,titleId:i,...r},c){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},r),a?n.createElement("title",{id:i},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Ne=n.forwardRef(_e);function Ce({title:a,titleId:i,...r},c){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},r),a?n.createElement("title",{id:i},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Fe=n.forwardRef(Ce),$="Car Profile",B=["status","lead","customer","car_make","car_model","car_year","car_brand_new","car_emirate","car_registration_date"],U=["date_of_birth","nationality","license_country","driving_experience","policy_start_date","current_policy_active","claims_last_12_months","no_claims_years","gcc_specification","personal_use_only","policy_fully_comprehensive"],ee={ignorFields:{}},Y=Object.fromEntries([...B,...U].map(a=>[a,""]));function Se({isOpen:a,onClose:i,carProfileId:r,customerId:c,customerName:o,leadId:m,leadName:x,onSuccess:p}){const{isDark:_,darkColorScheme:S,lightColorScheme:N}=re(),{data:l,isFetching:q}=ne({doctype:$,fields:JSON.stringify([...B,...U])}),[T,h]=n.useState([]),j=n.useMemo(()=>l&&{...l,fields:l.fields.map(t=>{if(t.fieldname==="status"&&t.options&&(m||x)){const d=t.options.split(`
`).filter(s=>s.trim()!=="Active").join(`
`);return{...t,options:d}}return t.fieldname==="car_model"?{...t,options_list:T}:t})},[l,m,x,T]),{data:b,isFetching:H,refetch:L}=le({doctype:$,id:a&&r?r:null,fields:JSON.stringify([...B,...U])});n.useEffect(()=>{a&&r&&L()},[a,r,L]);const u=ue(t=>{console.log("Add mutation completed successfully:",t),v(),p&&p(),i()}),k=fe(t=>{console.log("Update mutation completed successfully:",t),v(),p&&p(),i()}),{register:E,handleSubmit:M,formState:{errors:D,isSubmitting:V},control:z,reset:v,setValue:y}=pe({resolver:ye(ke((j==null?void 0:j.fields)||(l==null?void 0:l.fields))),defaultValues:Y,mode:"onChange"}),g=je({control:z,name:"car_make"}),A=n.useRef(g);n.useEffect(()=>{g?(A.current&&A.current!==g&&y("car_model",""),Q({doctype:"Model",fields:JSON.stringify(["name","title","make"]),filters:JSON.stringify([["make","=",g]])}).then(t=>{if(t!=null&&t.data){const d=t.data.map(s=>({label:s.title||s.name,value:s.name}));h(d)}else h([])}).catch(()=>{h([])})):(h([]),y("car_model","")),A.current=g},[g,y]),n.useEffect(()=>{a?r?b&&(v(b),b.car_make&&Q({doctype:"Model",fields:JSON.stringify(["name","title","make"]),filters:JSON.stringify([["make","=",b.car_make]])}).then(t=>{if(t!=null&&t.data){const d=t.data.map(s=>({label:s.title||s.name,value:s.name}));h(d)}}).catch(()=>{h([])})):(v(Y),h([]),(c||o)&&y("customer",c||o),m?y("lead",m):x&&y("lead",x)):(v(Y),h([]))},[a,r,b,c,o,m,x,v,y]);const J=t=>{if(console.log("Form submitted with data:",t),(m||x)&&t.status==="Active"){console.error('Cannot save with "Active" status when opened from Lead page'),y("status",t.status,{shouldValidate:!0});return}const d={...t};r||(m&&!d.lead?d.lead=m:x&&!d.lead&&(d.lead=x),(c||o)&&!d.customer&&(d.customer=c||o)),console.log("Submitting with data:",d),r?(console.log("Calling mutationUpdate..."),k.mutate({doctype:$,body:{...d,id:r}})):(console.log("Calling mutationAdd..."),u.mutate({doctype:$,body:d}))},R=t=>{console.log("Form validation errors:",t)};return q||a&&r&&H?e.jsx(O,{show:a,children:e.jsxs(W,{open:a,onClose:i,static:!1,autoFocus:!0,children:[e.jsx(w,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!u.isPending&&!k.isPending&&i()}}),e.jsx(w,{as:Z,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[r?"Edit":"New"," Car Profile"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsx(ie,{style:{"--sk-color":_?S[700]:N[300]}})})]})})]})}):e.jsx(O,{show:a,children:e.jsxs(W,{open:a,onClose:t=>{!u.isPending&&!k.isPending&&i()},static:u.isPending||k.isPending,autoFocus:!0,children:[e.jsx(w,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 z-60 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40",onClick:()=>{!u.isPending&&!k.isPending&&i()}}),e.jsxs(w,{as:Z,enter:"ease-out transform-gpu transition-transform duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-300",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed inset-y-0 right-0 z-61 flex w-screen max-w-3xl transform-gpu flex-col bg-white transition-transform duration-300 dark:bg-dark-700 sm:max-w-4xl lg:max-w-5xl",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:[r?"Edit":"New"," Car Profile"]}),e.jsx("button",{onClick:i,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(oe,{className:"size-5"})})]}),e.jsxs("form",{onSubmit:M(J,R),className:"flex min-h-0 flex-1 flex-col overflow-hidden",noValidate:!0,children:[e.jsx("div",{className:"scrollbar-sm flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 p-5 sm:gap-5 lg:gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-6",children:e.jsx(I,{infos:j||l,fields:B,register:E,tables:ee,control:z,errors:D})}),e.jsx("div",{className:"col-span-12 lg:col-span-6",children:e.jsx(I,{infos:j||l,tables:ee,fields:U,register:E,control:z,errors:D})})]})}),e.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(F,{variant:"outlined",onClick:i,children:"Cancel"}),e.jsx(F,{color:"primary",type:"button",onClick:M(J,R),disabled:V||u.isPending||k.isPending,children:V||u.isPending||k.isPending?"Saving...":r?"Update":"Create"})]})]})]})]})})}const ae="Car Profile",G=["status","car_make","car_model","car_year","car_brand_new","car_emirate","car_registration_date"],K=["date_of_birth","nationality","license_country","driving_experience","policy_start_date","current_policy_active","claims_last_12_months","no_claims_years","gcc_specification","personal_use_only","policy_fully_comprehensive"],se=(a,i)=>{var c;const r=(c=a==null?void 0:a.fields)==null?void 0:c.find(o=>o.fieldname===i);return(r==null?void 0:r.label)||i},te=a=>a==null||a===""?"-":a;function Te({isOpen:a,onClose:i,carProfileId:r}){const{isDark:c,darkColorScheme:o,lightColorScheme:m}=re(),{data:x,isFetching:p}=ne({doctype:ae,fields:JSON.stringify([...G,...K])}),{data:_,isFetching:S,refetch:N}=le({doctype:ae,id:a&&r?r:null,fields:JSON.stringify([...G,...K])});return n.useEffect(()=>{a&&r&&N()},[a,r,N]),p||a&&r&&S?e.jsx(O,{show:a,children:e.jsxs(W,{open:a,onClose:i,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(w,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:i}),e.jsxs(w,{as:Z,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl dark:bg-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 pb-4 dark:border-dark-500",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"})}),e.jsx("div",{className:"mt-4",children:e.jsx(ie,{style:{"--sk-color":c?o[700]:m[300]}})})]})]})}):_?e.jsx(O,{show:a,children:e.jsxs(W,{open:a,onClose:i,className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:[e.jsx(w,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40",onClick:i}),e.jsxs(w,{as:Z,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"scrollbar-sm relative flex max-h-[90vh] w-full max-w-4xl flex-col overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-dark-700",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-gray-200 px-6 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"View Car Profile"}),e.jsx("button",{onClick:i,className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(oe,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Car Information"}),e.jsx("div",{className:"space-y-3",children:G.map(l=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:se(x,l)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:te(_[l])})]},l))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-700 dark:text-dark-100",children:"Additional Information"}),e.jsx("div",{className:"space-y-3",children:K.map(l=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-dark-300",children:se(x,l)}),e.jsx("span",{className:"mt-1 text-sm text-gray-900 dark:text-dark-50",children:te(_[l])})]},l))})]})]})}),e.jsx("div",{className:"flex shrink-0 items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 dark:border-dark-500",children:e.jsx(F,{color:"primary",onClick:i,children:"Close"})})]})]})}):null}function Je({customerId:a,customerName:i,leadId:r,leadName:c}){const o=a||i?"customer":"lead",m=a||i||r||c,[x,p]=n.useState(!1),[_,S]=n.useState(!1),[N,l]=n.useState(null),[q,T]=n.useState(!1),[h,j]=n.useState(null),b=o==="customer"?["name","status","car_make","car_model","car_year","lead"]:["name","status","car_make","car_model","car_year","customer"],[H,L]=n.useState({doctype:"Car Profile",page:1,page_length:10,fields:JSON.stringify(b),filters:null}),{data:u,isFetching:k,refetch:E}=he(H),[M,D]=n.useState([]);n.useEffect(()=>{if(m){const s=[[o,"=",m]];o==="customer"?s.push(["status","=","Active"]):o==="lead"&&s.push(["status","!=","Active"]),L(f=>({...f,filters:JSON.stringify(s),fields:JSON.stringify(b)}))}},[m,o]),n.useEffect(()=>{u!=null&&u.data?D(u.data):D([])},[u]);const V=()=>{l(null),p(!0)},z=()=>{p(!1),l(null)},v=()=>{S(!1),l(null)},y=()=>{E()},g=ge(s=>{s&&s.success&&(T(!1),j(null),E())}),A=(s,f)=>{s.stopPropagation(),l(f),p(!0)},J=(s,f)=>{s.stopPropagation(),l(f),S(!0)},R=(s,f)=>{s.stopPropagation(),j(f),T(!0)},t=()=>{h&&g.mutate({doctype:"Car Profile",ids:[h]})},d=()=>{T(!1),j(null)};return e.jsxs(ce,{className:"p-4 sm:px-5",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-dark-50",children:"Car Profiles"}),o==="lead"&&e.jsxs(F,{size:"sm",color:"primary",onClick:V,className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"size-4"}),"Add Car Profile"]})]}),m?k?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading car profiles..."}):M.length===0?e.jsxs("div",{className:"py-8 text-center text-sm text-gray-500 dark:text-dark-300",children:["No car profiles found ",o==="customer"?"for this customer":"for this lead","."]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(X,{children:[e.jsx(C,{children:"Status"}),e.jsx(C,{children:"Make"}),e.jsx(C,{children:"Model"}),e.jsx(C,{children:"Year"}),o==="customer"?e.jsx(C,{children:"Lead"}):e.jsx(C,{children:"Customer"}),e.jsx(C,{children:"Actions"})]})}),e.jsx(xe,{children:M.map(s=>e.jsxs(X,{className:"hover:bg-gray-50 dark:hover:bg-dark-700",children:[e.jsx(P,{children:s.status||"-"}),e.jsx(P,{children:s.car_make||"-"}),e.jsx(P,{children:s.car_model||"-"}),e.jsx(P,{children:s.car_year||"-"}),e.jsx(P,{children:o==="customer"?s.lead||"-":s.customer||"-"}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o==="customer"&&e.jsx(F,{size:"sm",variant:"outlined",onClick:f=>J(f,s.name),className:"p-1.5",children:e.jsx(Ne,{className:"size-4"})}),o==="lead"&&e.jsx(F,{size:"sm",variant:"outlined",onClick:f=>A(f,s.name),className:"p-1.5",children:e.jsx(ve,{className:"size-4"})}),e.jsx(F,{size:"sm",variant:"outlined",color:"error",onClick:f=>R(f,s.name),className:"p-1.5",disabled:g.isPending,children:e.jsx(we,{className:"size-4"})})]})})]},s.name))})]})}):e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading information..."}),e.jsx(Se,{isOpen:x,onClose:z,carProfileId:N,customerId:a,customerName:i,leadId:r,leadName:c,onSuccess:y}),e.jsx(Te,{isOpen:_,onClose:v,carProfileId:N}),e.jsx(be,{show:q,onClose:d,onOk:t,confirmLoading:g.isPending,state:g.isError?"error":"pending",messages:{pending:{title:"Delete Car Profile?",description:"Are you sure you want to delete this car profile? This action cannot be undone.",actionText:"Delete"}}})]})}export{Je as C,Fe as F};
