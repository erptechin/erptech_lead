import{u as V,f as Y,t as G,a as c,j as e,S as K,B as _,C,v as Q,R as k,l as W,n as X,o as E,p as h,q as Z,s as g,M as ee}from"./index-LumR9LpT.js";import{u as se,o as te}from"./index.esm-DDFq6ecG.js";import{S as ae,D as O}from"./SearchSelect-CYt5ySf9.js";import{P as ie}from"./Page-DpNZoU2W.js";import{u as oe,b as re,c as ce,d as le,a as ne}from"./useApiHook-BaTdZUfY.js";import{F as me}from"./DocumentPlusIcon-D_4r1uaE.js";import{z as de,g as J}from"./transition-Bjlj-wUW.js";import{y as ue,j as pe}from"./iconBase-C2Zgi-_E.js";import"./combobox-Dj5cFH08.js";import"./use-by-comparator-DvNQncvR.js";import"./hidden-L3KgzKsU.js";import"./active-element-history-BpgmnmLd.js";import"./calculate-active-index-P522dhW6.js";import"./Datepicker-DYSyDBji.js";import"./frozen-Chw8VnFV.js";import"./label-Bynhy_B1.js";import"./ConfirmModal-DS6DE1gB.js";import"./useMutation-DIthQpx-.js";import"./floating-ui.dom-CtcSe9Ld.js";const I="Installation Note List",p="Installation Note",z=["inst_date","customer","custom_site","custom_delivery_note","items"],M=["custom_vehicle_no","custom_driver_name","custom_recipe_name","custom_recipe_code","inst_time","custom_start_time","status"],q={items:{item_code:!0,uom:!0,qty:!0,custom_bom_no:!0,custom_sales_order_no:!0}};function fe({isOpen:j,onClose:f,onSelect:v,customer:l}){const[a,N]=c.useState([]),[x,S]=c.useState({doctype:"Delivery Note",page:1,page_length:10,filters:JSON.stringify([["Delivery Note","status","!=","Draft"],["Delivery Note","customer","=",l],["Delivery Note","docstatus","=",1]]),fields:JSON.stringify(["name","customer","custom_site","posting_date"])}),{data:n}=ne(x);c.useEffect(()=>{S({...x,filters:JSON.stringify([["Delivery Note","status","!=","Draft"],["Delivery Note","customer","=",l],["Delivery Note","docstatus","=",1]])})},[l]),c.useEffect(()=>{n!=null&&n.data&&N(n.data)},[n]);const b=async i=>{var y;const s=await ee({doctype:"Delivery Note",filters:JSON.stringify([["Delivery Note","name","=",i.name]]),fields:JSON.stringify(["*"]),page_length:1});(y=s==null?void 0:s.data)!=null&&y[0]&&(v(s.data[0]),f())};return e.jsx(de,{appear:!0,show:j,as:k.Fragment,children:e.jsxs(ue,{as:"div",className:"fixed inset-0 z-100 flex flex-col items-center justify-center overflow-hidden px-4 py-6 sm:px-5",onClose:f,children:[e.jsx(J,{as:k.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"absolute inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"})}),e.jsx(J,{as:k.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsxs(pe,{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col overflow-y-auto rounded-lg bg-white p-4 transition-opacity duration-300 dark:bg-dark-700",children:[e.jsx("div",{className:"mb-4 flex justify-between items-center",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Select Delivery Note"})}),e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(E,{children:[e.jsx(h,{children:"Delivery Note"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Site"}),e.jsx(h,{children:"Action"})]})}),e.jsx(Z,{children:a.map(i=>e.jsxs(E,{children:[e.jsx(g,{children:i.name}),e.jsx(g,{children:i.posting_date}),e.jsx(g,{children:i.custom_site}),e.jsx(g,{children:e.jsx(_,{size:"sm",onClick:()=>b(i),children:"Select"})})]},i.name))})]})]})})]})})}function Ie(){const{isDark:j,darkColorScheme:f,lightColorScheme:v}=V(),l=Y(),{id:a}=G(),[N,x]=c.useState(null),[S,n]=c.useState({}),[b,i]=c.useState(!1),{data:s,isFetching:y}=oe({doctype:p,fields:JSON.stringify([...z,...M])}),{data:m,isFetching:A}=re({doctype:p,id:a,fields:JSON.stringify(N)});c.useEffect(()=>{if(s!=null&&s.fields){let t=s==null?void 0:s.fields.map(r=>r.fieldname);x(t),n(Object.fromEntries(t.map(r=>[r,""])))}},[s==null?void 0:s.fields]);const B=ce(t=>{t&&(T(),l(-1))}),R=le(async t=>{t&&(T(),l(-1))}),{register:D,handleSubmit:P,formState:{errors:F},control:w,reset:T,setValue:o,watch:d}=se({resolver:te(ae(s==null?void 0:s.fields)),values:a?m:S}),$=async t=>{a?(await Q({url:`policy_pro.api.doctype.update_data?doctype=${p}&name=${a}&update_fields=${JSON.stringify([{docstatus:0}])}`})).success&&(delete t.creation,delete t.modified,R.mutate({doctype:p,body:{...t,docstatus:1,id:a}})):B.mutate({doctype:p,body:{...t,docstatus:1}})},L=t=>{const r=new Date,U=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0");if(o("inst_date",U),o("customer",t.customer),o("custom_site",t.custom_site),o("custom_delivery_note",t.name),o("custom_vehicle_no",t.custom_vehicle),o("custom_driver_name",t.driver_name),t.items&&t.items.length>0){const H=t.items[0];o("custom_recipe_name",H.item_code),o("items",t.items.map(u=>({item_code:u.item_code,qty:u.qty,uom:u.uom,custom_bom_no:u.custom_bom_no,custom_sales_order_no:u.against_sales_order})))}};return y||A?e.jsx(K,{style:{"--sk-color":j?f[700]:v[300]}}):e.jsxs(ie,{title:(a?"Edit ":"New ")+I,children:[e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[a?"Edit":"New"," ",I]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>l(-1),children:"Back"}),e.jsx(_,{className:"min-w-[7rem]",color:"success",type:"submit",form:"new-post-form",children:"Submit"})]})]}),e.jsx("form",{autoComplete:"off",onSubmit:P($),id:"new-post-form",children:e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-8",children:e.jsx(C,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:!a&&!d("custom_delivery_note")?e.jsxs(e.Fragment,{children:[e.jsx(O,{infos:s,fields:["customer"],register:D,control:w,errors:F}),d("customer")&&e.jsx(_,{onClick:()=>i(!0),className:"flex items-center gap-2",children:"Select Delivery Note"})]}):e.jsx(e.Fragment,{children:e.jsx(O,{infos:s,fields:z,tables:q,register:D,control:w,errors:F,readOnly:(s==null?void 0:s.is_submittable)&&(m==null?void 0:m.docstatus)})})})})}),(a||d("custom_delivery_note"))&&e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-4 lg:space-y-6",children:e.jsx(C,{className:"space-y-5 p-4 sm:px-5",children:e.jsx(O,{infos:s,fields:M,tables:q,register:D,control:w,errors:F,readOnly:(s==null?void 0:s.is_submittable)&&(m==null?void 0:m.docstatus)})})})]})})]}),d("customer")&&e.jsx(fe,{isOpen:b,onClose:()=>i(!1),onSelect:L,customer:d("customer")})]})}export{Ie as default};
