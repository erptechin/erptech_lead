import{j as t,u as B,H as A,f as R,t as I,a as g,S as O,B as j}from"./index-LumR9LpT.js";import{u as P,o as T}from"./index.esm-DDFq6ecG.js";import{R as H,S as U}from"./SearchSelect-CYt5ySf9.js";import{P as V}from"./Page-DpNZoU2W.js";import{u as z,b as J,c as L,d as M}from"./useApiHook-BaTdZUfY.js";import{F as q}from"./DocumentPlusIcon-D_4r1uaE.js";import"./combobox-Dj5cFH08.js";import"./transition-Bjlj-wUW.js";import"./floating-ui.dom-CtcSe9Ld.js";import"./use-by-comparator-DvNQncvR.js";import"./hidden-L3KgzKsU.js";import"./active-element-history-BpgmnmLd.js";import"./calculate-active-index-P522dhW6.js";import"./Datepicker-DYSyDBji.js";import"./frozen-Chw8VnFV.js";import"./label-Bynhy_B1.js";import"./iconBase-C2Zgi-_E.js";import"./ConfirmModal-DS6DE1gB.js";import"./useMutation-DIthQpx-.js";function G({infos:p,ignorFields:f,register:x,control:o,errors:n,tables:m}){const c=p.fields.reduce((s,r)=>{if(r.fieldtype=="HTML"||r.fieldtype=="Tab Break"||f.includes(r.fieldname))return s;if(r.fieldtype==="Section Break")s.push({isSection:!0,label:r.label,description:r.description,fields:[[]]});else if(r.fieldtype==="Column Break")s.length===0&&s.push({isSection:!0,fields:[[]]}),s[s.length-1].fields.push([]);else{s.length===0&&s.push({isSection:!0,fields:[[]]});const a=s[s.length-1];a.fields[a.fields.length-1].push(r)}return s},[]);return t.jsx("div",{className:"w-full space-y-2",children:c.map((s,r)=>t.jsxs("div",{children:[s.label&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s.label}),s.description&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s.description})]}),s.fields.some(a=>a.length>0)&&t.jsx("div",{className:"flex flex-col md:flex-row flex-wrap gap-4 border-[0.1px] border-gray-200 rounded-lg",children:s.fields.map((a,d)=>t.jsx("div",{className:"flex-1 min-w-[250px] px-4 md:y-4 sm:y-2",children:a.map((e,h)=>t.jsx(H,{item:e,control:o,register:x,errors:n,tables:m},h))},d))})]},r))})}const N="Vehicle",u="Vehicle";function ue(){var S;const{isDark:p,darkColorScheme:f,lightColorScheme:x}=B(),{user:o}=A(),n=R(),{id:m}=I(),[c,s]=g.useState(null),[r,a]=g.useState({}),d=(S=o==null?void 0:o.settings)!=null&&S.is_enable_branch?[]:["custom_branch"],{data:e,isFetching:h}=z({doctype:u}),{data:l,isFetching:v}=J({doctype:u,id:m,fields:c?JSON.stringify(c):null});g.useEffect(()=>{if(e!=null&&e.fields){let i=e==null?void 0:e.fields.map(b=>b.fieldname);s(i),a(Object.fromEntries(i.map(b=>[b,""])))}},[e==null?void 0:e.fields]);const w=L(i=>{i&&(y(),n(-1))}),F=M(i=>{i&&(y(),n(-1))}),{register:k,handleSubmit:C,formState:{errors:D},control:_,reset:y}=P({resolver:T(U(e==null?void 0:e.fields)),values:m?l:r}),E=i=>{m?((i==null?void 0:i.status)==="Draft"&&(e!=null&&e.is_submittable)&&(i.docstatus=1),delete i.last_odometer,F.mutate({doctype:u,body:{...i,id:m}})):w.mutate({doctype:u,body:i})};return h||v?t.jsx(O,{style:{"--sk-color":p?f[700]:x[300]}}):t.jsx(V,{title:(m?"Edit ":"New ")+N,children:t.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[t.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(q,{className:"size-6"}),t.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[m?"Edit":"New"," ",N]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(j,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>n(-1),children:"Back"}),t.jsx(j,{className:"min-w-[7rem]",color:(l==null?void 0:l.status)==="Draft"&&(e!=null&&e.is_submittable)?"success":"primary",type:"submit",form:"new-post-form",children:(l==null?void 0:l.status)==="Draft"&&(e!=null&&e.is_submittable)?"Submit":"Save"})]})]}),t.jsx("form",{autoComplete:"off",onSubmit:C(E),id:"new-post-form",children:t.jsx(G,{infos:e,fields:c,ignorFields:d,register:k,control:_,errors:D,readOnly:(e==null?void 0:e.is_submittable)&&(l==null?void 0:l.docstatus)})})]})})}export{ue as default};
