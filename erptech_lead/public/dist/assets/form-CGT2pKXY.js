import{a as n,j as e,C as U,B as p,q as ie,s as de,t as J,v as u,w as ce,x as g,p as ae,l as A,J as B,I as R,U as se,A as re,y as N,z as fe,D as ye,e as ke,u as be,k as je,E as Ne,S as ve,G as _e}from"./index-D0jPsghG.js";import{u as we,o as Ce}from"./index.esm-Ca10EfXZ.js";import{F as H,S as $,a as te,b as De,D as le}from"./dynamicForms-jMV82aAw.js";import{P as Fe}from"./Page-C4UCss8O.js";import{c as Q,a as Se,b as Oe,d as Ae,u as Te,e as Ee}from"./useApiHook-DOqkRipi.js";import{F as me,C as Pe}from"./CarProfiles-CoeaHpCu.js";import{z as V,F}from"./transition-Dj__PYW9.js";import{y as G,j as K}from"./iconBase-CHfE39LV.js";import{C as Me}from"./ConfirmModal-czvcnqBf.js";import{F as ze,a as Re}from"./TrashIcon-DSXvluWB.js";import{F as $e}from"./DocumentPlusIcon-BWBqJN5c.js";import"./Datepicker-lBy-MwTE.js";import"./combobox-CMD7RAF0.js";import"./use-by-comparator-zPLuFEXI.js";import"./hidden-BVYCz9S5.js";import"./active-element-history-BokRLhg6.js";import"./calculate-active-index-CH3z7TqV.js";import"./use-tree-walker-D_IoPfUV.js";import"./frozen-DDkKDqOU.js";import"./label-CpgHZhTH.js";import"./useMutation-QAUetIMC.js";import"./floating-ui.dom-CtcSe9Ld.js";function Ie({id:i,data:r,setValue:S,refetchData:j}){var _;const[v,l]=n.useState(!1),[o,m]=n.useState({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]}),c=Q(t=>{t&&v&&(l(!1),j())}),C=()=>{if(o.description&&o.description.trim()&&o.next_date){const t=(r==null?void 0:r.custom_followup_history)||[],h=[...t,{...o,idx:t.length+1}];c.mutate({doctype:"Lead",body:{id:i,custom_followup_history:h,custom_next_follow_up_date:o.next_date,custom_lead_status:"Call Back"}}),S("custom_followup_history",h),m({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})}};return i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Follow-up History Records"}),e.jsxs(p,{onClick:()=>l(!0),color:"primary",className:"flex items-center gap-2",children:[e.jsx(me,{className:"size-4"}),"Add New Record"]})]}),r!=null&&r.custom_followup_history&&((_=r==null?void 0:r.custom_followup_history)==null?void 0:_.length)>0?e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(ie,{hoverable:!0,className:"w-full min-w-[600px] text-left rtl:text-right",children:[e.jsx(de,{children:e.jsxs(J,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"#"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Created Date"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Description"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Next Follow-up Date"})]})}),e.jsx(ce,{children:r==null?void 0:r.custom_followup_history.map((t,h)=>e.jsxs(J,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:h+1}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:t.created_date?new Date(t.created_date).toLocaleDateString():"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:t.description||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:t.next_date?new Date(t.next_date).toLocaleDateString():"-"})]},h))})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No follow-up records yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(V,{appear:!0,show:v,as:G,onClose:()=>l(!1),children:[e.jsx(F,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(F,{as:K,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-lg flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Follow-up History"}),e.jsx("button",{onClick:()=>l(!1),className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(H,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:o.description,onChange:t=>m({...o,description:t.target.value}),placeholder:"Enter follow-up description...",rows:"4",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Created Date"}),e.jsx("input",{type:"date",value:o.created_date,onChange:t=>m({...o,created_date:t.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Next Follow-up Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:o.next_date,onChange:t=>m({...o,next_date:t.target.value}),className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50",required:!0})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(p,{variant:"outlined",onClick:()=>{l(!1),m({description:"",next_date:"",created_date:new Date().toISOString().split("T")[0]})},children:"Cancel"}),e.jsx(p,{color:"primary",onClick:C,disabled:!o.description||!o.description.trim()||!o.next_date,children:"Add Record"})]})]})})]})]}):null}function Le({id:i,data:r}){const[S,j]=n.useState(!1),[v,l]=n.useState(!1),[o,m]=n.useState(null),[c,C]=n.useState(!1),[_,t]=n.useState(null),[h,T]=n.useState([]),[O,q]=n.useState([]),[s,d]=n.useState({lead:i||"",customer:(r==null?void 0:r.customer)||"",car_profile:"",approval_manager:"",policy_name:"",policy_amount:"",status:"Waiting",type:"New",file_attachment:"",comments:""}),[E,P]=n.useState({doctype:"COD Management",page:1,page_length:100,fields:JSON.stringify(["name","lead","customer","car_profile","approval_manager","policy_name","policy_amount","status","file_attachment","comments","creation","modified"]),filters:i?JSON.stringify([["lead","=",i],["type","=","New"]]):null}),{data:w,isFetching:M,refetch:D}=Se(E);n.useEffect(()=>{i&&(ae({doctype:"Car Profile",fields:JSON.stringify(["name","car_make","car_model","car_year"]),filters:JSON.stringify([["lead","=",i],["status","=","New"]]),page_length:100}).then(a=>{if(a!=null&&a.data){const x=a.data.map(b=>({label:`${b.car_make||""} ${b.car_model||""} ${b.car_year||""}`.trim()||b.name,value:b.name}));T(x)}}),ae({doctype:"User",fields:JSON.stringify(["name","full_name"]),filters:JSON.stringify([["role_profile_name","=","Lead Manager"]]),page_length:100}).then(a=>{if(a!=null&&a.data){const x=a.data.map(b=>({label:`${b.full_name||""}`.trim()||b.name,value:b.name}));q(x)}}))},[i]),n.useEffect(()=>{i&&P(a=>({...a,filters:JSON.stringify([["lead","=",i],["type","=","New"]])}))},[i]),n.useEffect(()=>{w!=null&&w.data?y(w.data):y([])},[w]);const[f,y]=n.useState([]),[X,Y]=n.useState(!1),[Z,ee]=n.useState(!1);Oe(a=>{a&&(j(!1),k(),D())}),Q(a=>{a&&(l(!1),m(null),k(),D())});const z=Ae(a=>{a&&a.success&&(C(!1),t(null),D())}),k=()=>{d({lead:i||"",customer:(r==null?void 0:r.customer)||"",car_profile:"",approval_manager:"",policy_name:"",policy_amount:"",status:"Waiting",type:"New",file_attachment:"",comments:""})},xe=async()=>{if(!s.file_attachment){N({message:"File attachment is required"});return}Y(!0);try{const a=await fe(s);a&&a.cod_id?(j(!1),k(),D()):N({message:"Failed to create COD Management"})}catch(a){console.error("Error creating COD Management:",a),N(a)}finally{Y(!1)}},pe=a=>{const x=f.find(b=>b.name===a);x&&(d({lead:x.lead||i||"",customer:x.customer||(r==null?void 0:r.customer)||"",car_profile:x.car_profile||"",approval_manager:x.approval_manager||"",policy_name:x.policy_name||"",policy_amount:x.policy_amount||"",status:x.status||"Waiting",file_attachment:x.file_attachment||"",comments:x.comments||""}),m(a),l(!0))},ue=async()=>{if(!o){N({message:"COD Management ID is required"});return}if(!s.file_attachment){N({message:"File attachment is required"});return}ee(!0);try{const a=await ye(o,s);a&&a.cod_id?(l(!1),m(null),k(),D()):N({message:"Failed to update COD Management"})}catch(a){console.error("Error updating COD Management:",a),N(a)}finally{ee(!1)}},ge=a=>{t(a),C(!0)},he=()=>{_&&z.mutate({doctype:"COD Management",ids:[_]})};return n.useEffect(()=>{r!=null&&r.customer&&d(a=>({...a,customer:r.customer}))},[r==null?void 0:r.customer]),i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"COD Document Approvals"}),e.jsxs(p,{onClick:()=>{k(),j(!0)},color:"primary",className:"flex items-center gap-2",children:[e.jsx(me,{className:"size-4"}),"Approvals Request"]})]}),M?e.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:"Loading COD documents..."}):f&&f.length>0?e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsxs(ie,{hoverable:!0,className:"w-full min-w-[900px] text-left rtl:text-right",children:[e.jsx(de,{children:e.jsxs(J,{className:"border-y border-transparent border-b-gray-200 dark:border-b-dark-500",children:[e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Customer"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Car Profile"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Policy Name"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Policy Amount"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Status"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Approval Manager"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"File Attachment"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Comments"}),e.jsx(u,{className:"bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100",children:"Actions"})]})}),e.jsx(ce,{children:f.map(a=>e.jsxs(J,{className:"border-b border-gray-200 dark:border-dark-500",children:[e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.customer||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.car_profile||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.policy_name||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.policy_amount?`AED ${parseFloat(a.policy_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:e.jsx("span",{className:A("inline-flex rounded-full px-2 py-1 text-xs font-semibold",a.status==="Approve"&&"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",a.status==="Decline"&&"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",a.status==="Waiting"&&"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"),children:a.status||"-"})}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.approval_manager||"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.file_attachment?e.jsx("a",{href:`${B}${a.file_attachment}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400",children:"View File"}):"-"}),e.jsx(g,{className:"text-gray-700 dark:text-dark-200",children:a.comments||"-"}),e.jsx(g,{children:a.status!=="Approve"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{size:"sm",variant:"outlined",onClick:()=>pe(a.name),className:"p-1.5",children:e.jsx(ze,{className:"size-4"})}),e.jsx(p,{size:"sm",variant:"outlined",color:"error",onClick:()=>ge(a.name),className:"p-1.5",disabled:z.isPending,children:e.jsx(Re,{className:"size-4"})})]})})]},a.name))})]})})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-dark-300",children:'No COD documents yet. Click "Add New Record" to add one.'})})]})})}),e.jsxs(V,{appear:!0,show:S,as:G,onClose:()=>{j(!1),k()},children:[e.jsx(F,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(F,{as:K,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Add Approvals Request"}),e.jsx("button",{onClick:()=>{j(!1),k()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(H,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx($,{label:"Car Profile",lists:h,value:s.car_profile,onChange:a=>d({...s,car_profile:a||""}),placeholder:"Select Car Profile",req:!0})}),e.jsx("div",{children:e.jsx($,{label:"Approval Manager",lists:O,value:s.approval_manager,onChange:a=>d({...s,approval_manager:a||""}),placeholder:"Select Approval Manager",req:!0})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["Policy Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(R,{value:s.policy_name,onChange:a=>d({...s,policy_name:a.target.value}),placeholder:"Enter Policy Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Policy Amount"}),e.jsx(R,{type:"number",value:s.policy_amount,onChange:a=>d({...s,policy_amount:a.target.value}),placeholder:"Enter Policy Amount",step:"0.01",min:"0"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["File Attachment ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(se,{onChange:a=>{a&&d({...s,file_attachment:a})},children:({...a})=>e.jsxs(p,{...a,unstyled:!0,className:A("mt-3 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-10 border-gray-300 dark:border-dark-450"),children:[e.jsx(te,{className:"size-12"}),e.jsxs("span",{className:A("pointer-events-none mt-2 text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your files here"})]}),s.file_attachment&&e.jsx("span",{className:"mt-2 text-sm text-gray-500 dark:text-dark-300",children:"File selected"})]})}),s.file_attachment&&e.jsx("div",{className:"mt-2 flex flex-col space-y-4",children:e.jsx("div",{className:"relative inline-block",children:e.jsx(re,{size:24,src:`${B}${s.file_attachment}`,classNames:{display:"rounded-lg"}})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:s.comments,onChange:a=>d({...s,comments:a.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(p,{variant:"outlined",onClick:()=>{j(!1),k()},children:"Cancel"}),e.jsx(p,{color:"primary",onClick:xe,disabled:!s.file_attachment||X,children:X?"Adding...":"Add Document"})]})]})})]}),e.jsxs(V,{appear:!0,show:v,as:G,onClose:()=>{l(!1),m(null),k()},children:[e.jsx(F,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 transition-opacity dark:bg-black/40"}),e.jsx(F,{as:K,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",className:"fixed inset-0 z-100 flex items-center justify-center overflow-hidden px-4 py-6 sm:px-5",children:e.jsxs("div",{className:"scrollbar-sm relative flex w-full max-w-2xl flex-col rounded-lg bg-white transition-opacity duration-300 dark:bg-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-dark-50",children:"Edit COD Document"}),e.jsx("button",{onClick:()=>{l(!1),m(null),k()},className:"rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-dark-600",children:e.jsx(H,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx($,{label:"Car Profile",lists:h,value:s.car_profile,onChange:a=>d({...s,car_profile:a||""}),placeholder:"Select Car Profile"})}),e.jsx("div",{children:e.jsx($,{label:"Approval Manager",lists:O,value:s.approval_manager,onChange:a=>d({...s,approval_manager:a||""}),placeholder:"Select Approval Manager"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Policy Name"}),e.jsx(R,{value:s.policy_name,onChange:a=>d({...s,policy_name:a.target.value}),placeholder:"Enter Policy Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Policy Amount"}),e.jsx(R,{type:"number",value:s.policy_amount,onChange:a=>d({...s,policy_amount:a.target.value}),placeholder:"Enter Policy Amount",step:"0.01",min:"0"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:["File Attachment ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(se,{onChange:a=>{a&&d({...s,file_attachment:a})},children:({...a})=>e.jsxs(p,{...a,unstyled:!0,className:A("mt-3 w-full shrink-0 flex-col rounded-lg border-2 border-dashed py-10 border-gray-300 dark:border-dark-450"),children:[e.jsx(te,{className:"size-12"}),e.jsxs("span",{className:A("pointer-events-none mt-2 text-gray-600 dark:text-dark-200"),children:[e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"Browse"}),e.jsx("span",{children:" or drop your files here"})]}),s.file_attachment&&e.jsx("span",{className:"mt-2 text-sm text-gray-500 dark:text-dark-300",children:"File selected"})]})}),s.file_attachment&&e.jsx("div",{className:"mt-2 flex flex-col space-y-4",children:e.jsx("div",{className:"relative inline-block",children:e.jsx(re,{size:24,src:`${B}${s.file_attachment}`,classNames:{display:"rounded-lg"}})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-dark-100",children:"Comments"}),e.jsx("textarea",{value:s.comments,onChange:a=>d({...s,comments:a.target.value}),placeholder:"Enter comments...",rows:"3",className:"w-full rounded-lg border border-gray-300 px-3 py-2 dark:border-dark-400 dark:bg-dark-500 dark:text-dark-50"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-5 py-4 dark:border-dark-500",children:[e.jsx(p,{variant:"outlined",onClick:()=>{l(!1),m(null),k()},children:"Cancel"}),e.jsx(p,{color:"primary",onClick:ue,disabled:!s.file_attachment||Z,children:Z?"Updating...":"Update Document"})]})]})})]}),e.jsx(Me,{show:c,onClose:()=>{C(!1),t(null)},onOk:he,confirmLoading:z.isPending,state:z.isError?"error":"pending",messages:{pending:{title:"Delete COD Document?",description:"Are you sure you want to delete this COD document? This action cannot be undone.",actionText:"Delete"}}})]}):null}const oe="Lead",W="Lead",I=["first_name","last_name","email_id","mobile_no"],L=["custom_assigned_user","custom_lead_status","custom_next_follow_up_date","source","custom_followup_history"],ne={ignorFields:{status:!0,custom_followup_history:!0}};function da(){const{user:{username:i}}=ke(),{isDark:r,darkColorScheme:S,lightColorScheme:j}=be(),v=je(),{id:l}=Ne(),{data:o,isFetching:m}=Te({doctype:W,fields:JSON.stringify([...I,...L])}),{data:c,isFetching:C,refetch:_}=Ee({doctype:W,id:l,fields:JSON.stringify([...I,...L])}),[t,h]=n.useState([]),[T,O]=n.useState(!1),q=Q(f=>{f&&(w(),v(-1))}),{register:s,handleSubmit:d,formState:{errors:E},control:P,reset:w,setValue:M}=we({resolver:Ce(De(o==null?void 0:o.fields,["status"])),values:l?c:{},defaultValues:Object.fromEntries([...I,...L].map(f=>[f,""]))}),D=async f=>{if(l){const y={...f};q.mutate({doctype:W,body:{...y,id:l}})}else{if(!t||t.length===0){N({message:"Please add at least one Car Profile before creating the lead."});return}O(!0);try{const y=await _e(f,t,i);if(!y||!y.lead_id&&!y.customer_id)throw new Error("Failed to create lead");w(),h([]),v(-1)}catch(y){console.error("Error creating lead:",y),N(y)}finally{O(!1)}}};return m||C?e.jsx(ve,{style:{"--sk-color":r?S[700]:j[300]}}):e.jsx(Fe,{title:(l?"Edit ":"New ")+oe,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[l?"Edit":"New"," ",oe]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>v(-1),children:"Back"}),e.jsx(p,{className:"min-w-[7rem]",color:"primary",type:"submit",form:"new-post-form",disabled:T,children:T?"Creating...":"Save"})]})]}),e.jsxs("form",{autoComplete:"off",onSubmit:d(D),id:"new-post-form",children:[e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx(Le,{id:l,data:c,setValue:M,refetchData:_}),e.jsx(Ie,{id:l,data:c,setValue:M,refetchData:_}),e.jsx("div",{className:"col-span-12 lg:col-span-7",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(le,{infos:o,fields:I,register:s,tables:ne,control:P,errors:E})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-5 lg:space-y-6",children:e.jsx(U,{className:"p-4 sm:px-5",children:e.jsx(le,{infos:o,tables:ne,fields:L,register:s,control:P,errors:E,readOnlyFields:["custom_lead_status","custom_next_follow_up_date"]})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Pe,{leadId:l,customerId:c==null?void 0:c.customer,leadName:(c==null?void 0:c.lead_name)||(c==null?void 0:c.name),isCreateMode:!l,carProfilesToCreate:t,setCarProfilesToCreate:h})})]})]})})}export{da as default};
